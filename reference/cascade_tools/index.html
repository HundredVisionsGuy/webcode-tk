
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../css_tools/">
      
      
        <link rel="next" href="../color_keywords/">
      
      
        
      
      
      <link rel="icon" href="../../docs/docs_assets/images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>cascade_tools.py - webcode-tk docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="dark" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cascade_toolspy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="webcode-tk docs" class="md-header__button md-logo" aria-label="webcode-tk docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M360.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m64.6 136.1c-12.5 12.5-12.5 32.8 0 45.3l73.4 73.4-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0zm-274.7 0c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l73.3-73.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            webcode-tk docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              cascade_tools.py
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="webcode-tk docs" class="md-nav__button md-logo" aria-label="webcode-tk docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M360.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m64.6 136.1c-12.5 12.5-12.5 32.8 0 45.3l73.4 73.4-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0zm-274.7 0c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l73.3-73.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg>

    </a>
    webcode-tk docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    webcode-tk Docs
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../html_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    html_tools.py
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../css_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    css_tools.py
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    cascade_tools.py
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    cascade_tools.py
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        cascade_tools
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree" class="md-nav__link">
    <span class="md-ellipsis">
      
        CSSAppliedTree
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CSSAppliedTree">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__adjust_child_colors" class="md-nav__link">
    <span class="md-ellipsis">
      
        __adjust_child_colors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__adjust_colors" class="md-nav__link">
    <span class="md-ellipsis">
      
        __adjust_colors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__adjust_font_size" class="md-nav__link">
    <span class="md-ellipsis">
      
        __adjust_font_size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__adjust_largeness" class="md-nav__link">
    <span class="md-ellipsis">
      
        __adjust_largeness
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__apply_colors" class="md-nav__link">
    <span class="md-ellipsis">
      
        __apply_colors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__apply_global_colors" class="md-nav__link">
    <span class="md-ellipsis">
      
        __apply_global_colors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__build_tree" class="md-nav__link">
    <span class="md-ellipsis">
      
        __build_tree
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__calculate_root_font_size" class="md-nav__link">
    <span class="md-ellipsis">
      
        __calculate_root_font_size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__get_children" class="md-nav__link">
    <span class="md-ellipsis">
      
        __get_children
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__get_filename" class="md-nav__link">
    <span class="md-ellipsis">
      
        __get_filename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__get_soup" class="md-nav__link">
    <span class="md-ellipsis">
      
        __get_soup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__set_global_colors" class="md-nav__link">
    <span class="md-ellipsis">
      
        __set_global_colors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.can_inherit_styles" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_inherit_styles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.extract_selectors" class="md-nav__link">
    <span class="md-ellipsis">
      
        extract_selectors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.targets_body" class="md-nav__link">
    <span class="md-ellipsis">
      
        targets_body
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.verify_weight" class="md-nav__link">
    <span class="md-ellipsis">
      
        verify_weight
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element" class="md-nav__link">
    <span class="md-ellipsis">
      
        Element
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Element">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.__build_contrast_report" class="md-nav__link">
    <span class="md-ellipsis">
      
        __build_contrast_report
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.__build_visited_contrast_report" class="md-nav__link">
    <span class="md-ellipsis">
      
        __build_visited_contrast_report
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.__set_direct_text" class="md-nav__link">
    <span class="md-ellipsis">
      
        __set_direct_text
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.ammend_bg_color" class="md-nav__link">
    <span class="md-ellipsis">
      
        ammend_bg_color
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.ammend_color_styles" class="md-nav__link">
    <span class="md-ellipsis">
      
        ammend_color_styles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.apply_background_color" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_background_color
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.been_applied" class="md-nav__link">
    <span class="md-ellipsis">
      
        been_applied
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.change_child_styles" class="md-nav__link">
    <span class="md-ellipsis">
      
        change_child_styles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.change_styles" class="md-nav__link">
    <span class="md-ellipsis">
      
        change_styles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.directly_targets" class="md-nav__link">
    <span class="md-ellipsis">
      
        directly_targets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.get_contrast_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_contrast_data
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.__get_element_by_id" class="md-nav__link">
    <span class="md-ellipsis">
      
        __get_element_by_id
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.attribute_selector_applies" class="md-nav__link">
    <span class="md-ellipsis">
      
        attribute_selector_applies
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.descendant_selector_applies" class="md-nav__link">
    <span class="md-ellipsis">
      
        descendant_selector_applies
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.does_selector_apply" class="md-nav__link">
    <span class="md-ellipsis">
      
        does_selector_apply
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.get_color_contrast_details" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_color_contrast_details
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.get_color_contrast_report" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_color_contrast_report
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.get_color_contrast_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_color_contrast_results
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.is_selector_pseudoclass" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_selector_pseudoclass
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.targets_element_directly" class="md-nav__link">
    <span class="md-ellipsis">
      
        targets_element_directly
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.update_contrast_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_contrast_results
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../color_keywords/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    color_keywords.py
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../color_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    color_tools.py
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../animation_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    animation_tools.py
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ux_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ux_tools.py
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    utils.py
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../validator_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    validator_tools.py
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../explanation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Explanation
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        cascade_tools
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree" class="md-nav__link">
    <span class="md-ellipsis">
      
        CSSAppliedTree
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CSSAppliedTree">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__adjust_child_colors" class="md-nav__link">
    <span class="md-ellipsis">
      
        __adjust_child_colors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__adjust_colors" class="md-nav__link">
    <span class="md-ellipsis">
      
        __adjust_colors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__adjust_font_size" class="md-nav__link">
    <span class="md-ellipsis">
      
        __adjust_font_size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__adjust_largeness" class="md-nav__link">
    <span class="md-ellipsis">
      
        __adjust_largeness
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__apply_colors" class="md-nav__link">
    <span class="md-ellipsis">
      
        __apply_colors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__apply_global_colors" class="md-nav__link">
    <span class="md-ellipsis">
      
        __apply_global_colors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__build_tree" class="md-nav__link">
    <span class="md-ellipsis">
      
        __build_tree
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__calculate_root_font_size" class="md-nav__link">
    <span class="md-ellipsis">
      
        __calculate_root_font_size
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__get_children" class="md-nav__link">
    <span class="md-ellipsis">
      
        __get_children
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__get_filename" class="md-nav__link">
    <span class="md-ellipsis">
      
        __get_filename
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__get_soup" class="md-nav__link">
    <span class="md-ellipsis">
      
        __get_soup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.__set_global_colors" class="md-nav__link">
    <span class="md-ellipsis">
      
        __set_global_colors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.can_inherit_styles" class="md-nav__link">
    <span class="md-ellipsis">
      
        can_inherit_styles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.extract_selectors" class="md-nav__link">
    <span class="md-ellipsis">
      
        extract_selectors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.targets_body" class="md-nav__link">
    <span class="md-ellipsis">
      
        targets_body
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.CSSAppliedTree.verify_weight" class="md-nav__link">
    <span class="md-ellipsis">
      
        verify_weight
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element" class="md-nav__link">
    <span class="md-ellipsis">
      
        Element
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Element">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.__build_contrast_report" class="md-nav__link">
    <span class="md-ellipsis">
      
        __build_contrast_report
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.__build_visited_contrast_report" class="md-nav__link">
    <span class="md-ellipsis">
      
        __build_visited_contrast_report
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.__set_direct_text" class="md-nav__link">
    <span class="md-ellipsis">
      
        __set_direct_text
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.ammend_bg_color" class="md-nav__link">
    <span class="md-ellipsis">
      
        ammend_bg_color
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.ammend_color_styles" class="md-nav__link">
    <span class="md-ellipsis">
      
        ammend_color_styles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.apply_background_color" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_background_color
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.been_applied" class="md-nav__link">
    <span class="md-ellipsis">
      
        been_applied
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.change_child_styles" class="md-nav__link">
    <span class="md-ellipsis">
      
        change_child_styles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.change_styles" class="md-nav__link">
    <span class="md-ellipsis">
      
        change_styles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.directly_targets" class="md-nav__link">
    <span class="md-ellipsis">
      
        directly_targets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.Element.get_contrast_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_contrast_data
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.__get_element_by_id" class="md-nav__link">
    <span class="md-ellipsis">
      
        __get_element_by_id
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.attribute_selector_applies" class="md-nav__link">
    <span class="md-ellipsis">
      
        attribute_selector_applies
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.descendant_selector_applies" class="md-nav__link">
    <span class="md-ellipsis">
      
        descendant_selector_applies
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.does_selector_apply" class="md-nav__link">
    <span class="md-ellipsis">
      
        does_selector_apply
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.get_color_contrast_details" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_color_contrast_details
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.get_color_contrast_report" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_color_contrast_report
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.get_color_contrast_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_color_contrast_results
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.is_selector_pseudoclass" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_selector_pseudoclass
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.targets_element_directly" class="md-nav__link">
    <span class="md-ellipsis">
      
        targets_element_directly
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webcode_tk.cascade_tools.update_contrast_results" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_contrast_results
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="cascade_toolspy">cascade_tools.py</h1>


<div class="doc doc-object doc-module">



<a id="webcode_tk.cascade_tools"></a>
    <div class="doc doc-contents first">

        <p>Cascade Tools
This module is a set of tools to determine CSS as applied through
inheritance and the cascade.</p>
<p>The goal is to use the DOM, inheritance, and the cascade, to determine
all styles applied to every element on the page.</p>
<p>With that, it scans each stylesheet and applies each style one at a time
to all elements and their children (if applicable) of a page.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="webcode_tk.cascade_tools.CSSAppliedTree" class="doc doc-heading">
            <code>CSSAppliedTree</code>


</h2>


    <div class="doc doc-contents ">



        <p>a tree of an HTML document with all styles applied.</p>
<p>The point is to identify every element and the styles
applied to that element based on inheritance and
specificity rules (like you would see in the inspector)</p>
<p>We'll use an Element object for storing the tree.
Each node is an element (starting at HTML) and a optionally
a list of attributes as individual key value pairs.
Each node has 1 or more children (their nested elements).</p>
<p>In addition, each node has a list of computed rules.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="webcode_tk.cascade_tools.CSSAppliedTree.soup">soup</span></code></td>
            <td>
                  <code><span title="BeautifulSoup">BeautifulSoup</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a bs4 object representing the page</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="webcode_tk.cascade_tools.CSSAppliedTree.file_path">file_path</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the file as a string.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="webcode_tk.cascade_tools.CSSAppliedTree.stylesheets">stylesheets</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of all stylesheet objects applied to the
page.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="webcode_tk.cascade_tools.CSSAppliedTree.root">root</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Element (webcode_tk.cascade_tools.Element)" href="#webcode_tk.cascade_tools.Element">Element</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the root node of the document (the HTML
element).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="webcode_tk.cascade_tools.CSSAppliedTree.children">children</span></code></td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of all child elements of the doc
(minus the title tag).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CSSAppliedTree</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;a tree of an HTML document with all styles applied.</span>

<span class="sd">    The point is to identify every element and the styles</span>
<span class="sd">    applied to that element based on inheritance and</span>
<span class="sd">    specificity rules (like you would see in the inspector)</span>

<span class="sd">    We&#39;ll use an Element object for storing the tree.</span>
<span class="sd">    Each node is an element (starting at HTML) and a optionally</span>
<span class="sd">    a list of attributes as individual key value pairs.</span>
<span class="sd">    Each node has 1 or more children (their nested elements).</span>

<span class="sd">    In addition, each node has a list of computed rules.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        soup (BeautifulSoup): a bs4 object representing the page</span>
<span class="sd">        file_path (str): path to the file as a string.</span>
<span class="sd">        stylesheets: list of all stylesheet objects applied to the</span>
<span class="sd">            page.</span>
<span class="sd">        root (Element): the root node of the document (the HTML</span>
<span class="sd">            element).</span>
<span class="sd">        children (list): a list of all child elements of the doc</span>
<span class="sd">            (minus the title tag).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">stylesheets</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soup</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stylesheets</span> <span class="o">=</span> <span class="n">stylesheets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_font_size</span> <span class="o">=</span> <span class="mf">16.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__get_filename</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__get_soup</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__get_font_rules</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__calculate_root_font_size</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__build_tree</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__adjust_largeness</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__apply_colors</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__get_soup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets bs4 soup from the file path</span>

<span class="sd">        Args:</span>
<span class="sd">            path: the relative file path to the html document</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soup</span> <span class="o">=</span> <span class="n">html_tools</span><span class="o">.</span><span class="n">get_html</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts filename from path&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">clerk</span><span class="o">.</span><span class="n">get_file_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__get_font_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stylesheets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font_rules</span> <span class="o">+=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_all_font_rules</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__calculate_root_font_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;checks stylesheets for global font-size settings and adjusts&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stylesheets</span><span class="p">:</span>
            <span class="n">font_rules</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_all_font_rules</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">font_rules</span><span class="p">:</span>
                <span class="n">selector</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">is_global</span> <span class="o">=</span> <span class="n">selector</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
                <span class="n">not_at_rule</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">rule</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;at_rule&quot;</span><span class="p">)</span>
                <span class="n">is_size_property</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;property&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;font-size&quot;</span>
                <span class="k">if</span> <span class="n">is_global</span> <span class="ow">and</span> <span class="n">is_size_property</span> <span class="ow">and</span> <span class="n">not_at_rule</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                    <span class="n">size</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">split_value_unit</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">computed_value</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">compute_font_size</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">root_font_size</span> <span class="o">=</span> <span class="n">computed_value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__build_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs initial tree (recursively?)&quot;&quot;&quot;</span>
        <span class="c1"># Start with the body element, and divide and conquer</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;html&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
        <span class="n">root_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">parent_bg</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span>
            <span class="s2">&quot;body&quot;</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">parent_bg</span><span class="p">],</span>
            <span class="n">parent_size</span><span class="o">=</span><span class="n">root_font_size</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">body</span><span class="o">.</span><span class="n">parent_size</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">font_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="n">body_soup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">body</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">body_soup</span><span class="o">.</span><span class="n">attrs</span>
        <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">body</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_font_size</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="n">children</span> <span class="o">=</span> <span class="n">body_soup</span><span class="o">.</span><span class="n">contents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__get_children</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">soup_contents</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;gets all children of the element and their children from the soup</span>

<span class="sd">        The soup refers to the bs4 (Beautiful Soup) of the HTML element.</span>

<span class="sd">        Args:</span>
<span class="sd">            element: the parent element.</span>
<span class="sd">            soup_contents: a list of all items in the bs4 soup</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">soup_contents</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="n">tag_name</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">tag_name</span> <span class="o">==</span> <span class="s2">&quot;script&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">tag_children</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">contents</span>
            <span class="n">tag_attributes</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">attrs</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">element</span><span class="p">)]</span>
            <span class="n">new_element</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span>
                <span class="n">tag_name</span><span class="p">,</span>
                <span class="n">attributes</span><span class="o">=</span><span class="n">tag_attributes</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="n">parent_size</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
                <span class="n">ancestors</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">ancestors</span><span class="p">,</span>
                <span class="n">tag_contents</span><span class="o">=</span><span class="n">tag</span><span class="o">.</span><span class="n">contents</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__adjust_font_size</span><span class="p">(</span><span class="n">new_element</span><span class="p">)</span>
            <span class="n">element</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_element</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tag_children</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">their_kids</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">contents</span>
                    <span class="n">kids_attributes</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">attrs</span>
                    <span class="k">if</span> <span class="n">kids_attributes</span><span class="p">:</span>
                        <span class="n">kid_element</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span>
                            <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">attributes</span><span class="o">=</span><span class="n">kids_attributes</span><span class="p">,</span>
                            <span class="n">parent</span><span class="o">=</span><span class="p">[</span><span class="n">new_element</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">new_element</span><span class="p">)],</span>
                            <span class="n">parent_size</span><span class="o">=</span><span class="n">new_element</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
                            <span class="n">ancestors</span><span class="o">=</span><span class="n">new_element</span><span class="o">.</span><span class="n">ancestors</span><span class="p">,</span>
                            <span class="n">tag_contents</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">contents</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">kid_element</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span>
                            <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">parent</span><span class="o">=</span><span class="p">[</span><span class="n">new_element</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">new_element</span><span class="p">)],</span>
                            <span class="n">parent_size</span><span class="o">=</span><span class="n">new_element</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
                            <span class="n">ancestors</span><span class="o">=</span><span class="n">new_element</span><span class="o">.</span><span class="n">ancestors</span><span class="p">,</span>
                            <span class="n">tag_contents</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">contents</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__adjust_font_size</span><span class="p">(</span><span class="n">kid_element</span><span class="p">)</span>
                    <span class="n">new_element</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kid_element</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__get_children</span><span class="p">(</span><span class="n">kid_element</span><span class="p">,</span> <span class="n">their_kids</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_selectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get background color and color selectors&quot;&quot;&quot;</span>
        <span class="n">bg_data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">col_data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">Element</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">):</span>
                <span class="n">bg_color</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="n">bg_selector</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
                <span class="n">bg_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;bg: </span><span class="si">{</span><span class="n">bg_color</span><span class="si">}</span><span class="s2"> selector: </span><span class="si">{</span><span class="n">bg_selector</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">):</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="n">col_selector</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
                <span class="n">col_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;color: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2"> selector: </span><span class="si">{</span><span class="n">col_selector</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">bg_data</span><span class="p">,</span> <span class="n">col_data</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__adjust_largeness</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;sets the is_large property based on whether it&#39;s bold or not</span>
<span class="sd">        and the computed font size.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_is_large</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_is_large</span><span class="p">(</span><span class="n">kid</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_is_large</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">font_size</span>
        <span class="n">is_bold</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">is_bold</span>
        <span class="n">is_large</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">is_large_text</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">is_bold</span><span class="p">)</span>
        <span class="n">element</span><span class="o">.</span><span class="n">is_large</span> <span class="o">=</span> <span class="n">is_large</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">kiddo</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_is_large</span><span class="p">(</span><span class="n">kiddo</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__apply_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;applies all color rules to any elements targeted by styles.</span>

<span class="sd">        This includes by the cascade and by applying specificity. We&#39;ll</span>
<span class="sd">        loop through all color styles applied from the stylesheets.</span>

<span class="sd">        After all styles have been applied, do one last check to see</span>
<span class="sd">        if anything wasn&#39;t applied, and then apply the default colors.&quot;&quot;&quot;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_global_colors</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stylesheets</span><span class="p">:</span>
            <span class="n">color_rules</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">color_rulesets</span>
            <span class="k">for</span> <span class="n">ruleset</span> <span class="ow">in</span> <span class="n">color_rules</span><span class="p">:</span>
                <span class="c1"># get filename</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">clerk</span><span class="o">.</span><span class="n">get_file_name</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">href</span><span class="p">)</span>
                <span class="n">selector_source</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                    <span class="n">selector_source</span> <span class="o">=</span> <span class="s2">&quot;body&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Wait, what?&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__adjust_colors</span><span class="p">(</span>
                    <span class="n">body</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">selector_src</span><span class="o">=</span><span class="n">selector_source</span>
                <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">targets_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns whether the ruleset is targetting the body or not.</span>

<span class="sd">        Args:</span>
<span class="sd">            ruleset: a dictionary of selectors and their declaration blocks.</span>

<span class="sd">        Returns:</span>
<span class="sd">            body_in_ruleset: whether body is in one of the selectors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">body_in_ruleset</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">selector</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ruleset</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="s2">&quot;body&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
                <span class="n">body_in_ruleset</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">body_in_ruleset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__set_global_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Element</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;sets global colors to the body element.</span>

<span class="sd">        This loops through all stylesheets, and at each iteration, it checks</span>
<span class="sd">        specificity, and if the global colors beat previous specificity, they</span>
<span class="sd">        get applied. The last of the styles to be applied win, and we return</span>
<span class="sd">        the body element with global colors applied.</span>

<span class="sd">        Returns:</span>
<span class="sd">            body: the Body element with global colors applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stylesheets</span><span class="p">:</span>
            <span class="n">global_colors</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_global_color_details</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">rulesets</span><span class="p">)</span>
            <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">clerk</span><span class="o">.</span><span class="n">get_file_name</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">href</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">global_colors</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__apply_global_colors</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">global_colors</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">body</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__apply_global_colors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">global_colors</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;user-agent&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;recursively apply global colors to all elements</span>
<span class="sd">        except color on links (they remain default)</span>

<span class="sd">        base case is an element with no children</span>

<span class="sd">        Args:</span>
<span class="sd">            element: the tag we are applying colors to.</span>
<span class="sd">            global_colors: a list of global color data.</span>
<span class="sd">            filename: the stylesheet where the global styles come from.&quot;&quot;&quot;</span>
        <span class="c1"># first apply styles with specificity</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">global_colors</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">global_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">global_colors</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">gc</span> <span class="ow">in</span> <span class="n">global_colors</span><span class="p">:</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
            <span class="n">specificity</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_specificity</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
            <span class="n">gc</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specificity</span>
            <span class="n">element</span><span class="o">.</span><span class="n">ammend_color_styles</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

            <span class="c1"># loop through all children and call</span>
            <span class="n">children</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">children</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__apply_global_colors</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">gc</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__adjust_colors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span>
        <span class="n">ruleset</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">applied_by</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">selector_src</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;recursively adjust color where necessary to all elements that</span>
<span class="sd">        apply.</span>

<span class="sd">        Step 1: recursively search through children until we find an</span>
<span class="sd">        element where the selector applies (both by selector and by</span>
<span class="sd">        specificity).</span>

<span class="sd">        Step 2: if we find a selector that applies, apply changes to</span>
<span class="sd">        element AND all children that have same or lower specificity</span>
<span class="sd">        except a link (unless the selector is a link)</span>

<span class="sd">        Args:</span>
<span class="sd">            element: the element in question.</span>
<span class="sd">            ruleset: the ruleset we want to apply.</span>
<span class="sd">            filename: the file where the styles came from.&quot;&quot;&quot;</span>
        <span class="c1"># If there is a parent, it&#39;s a good time to adjust the direct ancestor</span>
        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="n">bg_sel</span><span class="p">,</span> <span class="n">col_sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_selectors</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="n">direct_ancestor</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">ancestors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">direct_ancestor</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">direct_ancestor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">direct_ancestor</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">direct_ancestor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bg_sel</span><span class="p">)</span>
                <span class="n">direct_ancestor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_sel</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">direct_ancestor</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">direct_ancestor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg_sel</span>
                <span class="n">direct_ancestor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_sel</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">direct_ancestor</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">direct_ancestor</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg_sel</span>
                <span class="n">direct_ancestor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">col_sel</span>

        <span class="c1"># Adjust colors if necessary - if there was a change,</span>
        <span class="c1"># adjust colors for children</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ruleset</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># does the selector apply to the element?</span>
        <span class="n">selector_applies</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">specificity</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_specificity</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
        <span class="n">declaration</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ruleset</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">property</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">declaration</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">is_background_prop</span> <span class="o">=</span> <span class="s2">&quot;background&quot;</span> <span class="ow">in</span> <span class="nb">property</span>
        <span class="k">if</span> <span class="n">is_background_prop</span><span class="p">:</span>
            <span class="n">old_specificity</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">old_specificity</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
        <span class="n">applies</span> <span class="o">=</span> <span class="n">does_selector_apply</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>
        <span class="n">selector_applies</span> <span class="o">=</span> <span class="p">(</span><span class="n">specificity</span> <span class="o">&gt;=</span> <span class="n">old_specificity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">applies</span>
        <span class="k">if</span> <span class="n">selector_applies</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_background_prop</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">declaration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">declaration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">property</span> <span class="o">==</span> <span class="s2">&quot;background-image&quot;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">declaration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background-image&quot;</span><span class="p">)</span>
                <span class="n">element</span><span class="o">.</span><span class="n">apply_background_color</span><span class="p">(</span>
                    <span class="n">selector</span><span class="p">,</span>
                    <span class="nb">property</span><span class="p">,</span>
                    <span class="n">value</span><span class="p">,</span>
                    <span class="n">old_specificity</span><span class="p">,</span>
                    <span class="n">specificity</span><span class="p">,</span>
                    <span class="n">filename</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;:hover&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">hover_color</span>
                <span class="k">elif</span> <span class="s2">&quot;:visited&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">visited_color</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">color</span>
                <span class="n">color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">declaration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">)</span>
                <span class="n">color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
                <span class="n">color</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
                <span class="n">color</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specificity</span>
                <span class="n">color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;directly&quot;</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">element_name</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__adjust_child_colors</span><span class="p">(</span>
                    <span class="n">child</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">element_name</span>
                <span class="p">)</span>
        <span class="n">can_inherit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_inherit_styles</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">can_inherit</span> <span class="ow">and</span> <span class="n">applies</span><span class="p">:</span>
            <span class="n">declaration</span> <span class="o">=</span> <span class="n">ruleset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
            <span class="n">new_specificity</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_specificity</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
            <span class="n">element</span><span class="o">.</span><span class="n">change_styles</span><span class="p">(</span>
                <span class="n">selector</span><span class="p">,</span> <span class="n">declaration</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__adjust_colors</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">element</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__adjust_child_colors</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">child</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span>
        <span class="n">ruleset</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">applied_by</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;adjusts colors for child of an element.</span>

<span class="sd">        A parent element already had styles applied, so we only need to check</span>
<span class="sd">        to see if the child element is a link or not (as well as the selector)</span>
<span class="sd">        and check the specificity of the ruleset.</span>

<span class="sd">        To help with background colors, we need to know where it was applied</span>
<span class="sd">        from (name of tag) - that way we can check if a declaration was applied</span>
<span class="sd">        by one of the tag&#39;s parents. If it was, then we apply that color by</span>
<span class="sd">        context taking the background from the nearest parent.</span>

<span class="sd">        Args:</span>
<span class="sd">            child: the child element in question</span>
<span class="sd">            ruleset: the CSS rule being applied</span>
<span class="sd">            filename: name of the file where the styles came from</span>
<span class="sd">            applied_from: the name of the element that was targetted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># First adjust direct ancestor</span>

        <span class="c1"># Adjust colors if necessary - if there was a change,</span>
        <span class="c1"># adjust colors for children</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ruleset</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">is_link_selector</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">is_link_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
        <span class="n">element_name</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span>
        <span class="n">can_inherit</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">is_link_selector</span>
            <span class="ow">and</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_link_selector</span>
            <span class="ow">and</span> <span class="n">element_name</span> <span class="o">!=</span> <span class="s2">&quot;a&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">can_inherit</span><span class="p">:</span>
            <span class="n">declaration</span> <span class="o">=</span> <span class="n">ruleset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
            <span class="n">new_specificity</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_specificity</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">change_styles</span><span class="p">(</span>
                <span class="n">selector</span><span class="p">,</span> <span class="n">declaration</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__adjust_child_colors</span><span class="p">(</span><span class="n">kid</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__adjust_font_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;looks for rules that apply and then adjusts accordingly</span>

<span class="sd">        Args:</span>
<span class="sd">            element: the Element object we wish to adjust.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">######################################################</span>
        <span class="c1"># WHat happens if we first change size to parent size?</span>
        <span class="c1"># element.font_size = element.parent_size</span>
        <span class="c1">######################################################</span>

        <span class="c1"># loop through rules and if they apply, then adjust</span>
        <span class="c1"># adjust for all children</span>
        <span class="k">for</span> <span class="n">selector</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_rules</span><span class="p">:</span>
            <span class="n">selector_applies</span> <span class="o">=</span> <span class="n">does_selector_apply</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>
            <span class="nb">property</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;property&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">property</span> <span class="o">==</span> <span class="s2">&quot;font&quot;</span><span class="p">:</span>
                <span class="n">is_valid_property</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">is_valid_shorthand</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_property</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">property</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="s2">&quot;font-weight&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">selector_applies</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verify_weight</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
            <span class="n">adjusts_font_size</span> <span class="o">=</span> <span class="nb">property</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="s2">&quot;font-size&quot;</span><span class="p">)</span>
            <span class="n">not_at_rule</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;at_rule&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">selector_applies</span> <span class="ow">and</span> <span class="n">adjusts_font_size</span> <span class="ow">and</span> <span class="n">not_at_rule</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="n">val</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">split_value_unit</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">computed_size</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">compute_font_size</span><span class="p">(</span>
                    <span class="n">val</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">parent_size</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">computed_size</span> <span class="o">!=</span> <span class="n">element</span><span class="o">.</span><span class="n">font_size</span><span class="p">:</span>
                    <span class="n">element</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">computed_size</span>
                    <span class="c1"># recursively change font size on all children</span>
                    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">computed_size</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_font_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">selector</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_rules</span><span class="p">:</span>
            <span class="n">selector_applies</span> <span class="o">=</span> <span class="n">does_selector_apply</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>
            <span class="n">is_at_rule</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;at_rule&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">selector_applies</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_at_rule</span><span class="p">:</span>
                <span class="c1"># get the other stuff and process</span>
                <span class="nb">property</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;property&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">property</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="s2">&quot;font-size&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">change_font_size</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">change_font_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">declaration</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">declaration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
            <span class="n">parent_size</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">font_size</span>
            <span class="n">element</span><span class="o">.</span><span class="n">parent_size</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">font_size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent_size</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">parent_size</span>
        <span class="n">size</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">split_value_unit</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">computed_size</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">compute_font_size</span><span class="p">(</span>
            <span class="n">size</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">parent_size</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span>
        <span class="n">element</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">computed_size</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">verify_weight</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="nb">property</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;verifies whether font weight is set to bold.&quot;&quot;&quot;</span>
        <span class="n">is_bold</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">property</span> <span class="o">==</span> <span class="s2">&quot;font&quot;</span><span class="p">:</span>
            <span class="n">is_valid_shorthand</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">is_valid_shorthand</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_valid_shorthand</span><span class="p">:</span>
                <span class="n">is_bold</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_bold</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">is_bold</span><span class="p">:</span>
            <span class="n">element</span><span class="o">.</span><span class="n">is_bold</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">can_inherit_styles</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns whether element can get styles through inheritance.</span>

<span class="sd">        Descendant elements may inherit styles, but only under certain</span>
<span class="sd">        conditions: The element is not a link (or it is a link but the</span>
<span class="sd">        selector is selecting it also by type, class, or id). The</span>
<span class="sd">        element has not had other styles applied to it.</span>

<span class="sd">        There may be more, but this is it for now.</span>

<span class="sd">        Args:</span>
<span class="sd">            element: the tag that is a descendant of another tag targetted</span>
<span class="sd">                by the selector.</span>
<span class="sd">            selector: the selector in question.</span>
<span class="sd">            ruleset: the ruleset dictionary (the key is the selector, and</span>
<span class="sd">                the value is the declaration block).</span>

<span class="sd">        Returns:</span>
<span class="sd">            can_inherit: whether the element should get the inherited</span>
<span class="sd">                styles or not.&quot;&quot;&quot;</span>
        <span class="n">can_inherit</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">element_name</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span>
        <span class="c1"># is it a link?</span>
        <span class="k">if</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
            <span class="n">is_link_selector</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">is_link_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_link_selector</span><span class="p">:</span>
                <span class="n">can_inherit</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="n">can_inherit</span>
        <span class="n">selector_applies</span> <span class="o">=</span> <span class="n">does_selector_apply</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selector_applies</span><span class="p">:</span>
            <span class="n">can_inherit</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">can_inherit</span><span class="p">:</span>
            <span class="c1"># check to see how property has been changed.</span>
            <span class="p">(</span><span class="n">declaration</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ruleset</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">(</span><span class="nb">property</span><span class="p">,)</span> <span class="o">=</span> <span class="n">declaration</span>
            <span class="k">if</span> <span class="s2">&quot;background&quot;</span> <span class="ow">in</span> <span class="nb">property</span><span class="p">:</span>
                <span class="n">applied_by</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;applied_by&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">applied_by</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;applied_by&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;selector&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">applied_by</span><span class="p">:</span>
                <span class="n">can_inherit</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">can_inherit</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.__adjust_child_colors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__adjust_child_colors</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">applied_by</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>adjusts colors for child of an element.</p>
<p>A parent element already had styles applied, so we only need to check
to see if the child element is a link or not (as well as the selector)
and check the specificity of the ruleset.</p>
<p>To help with background colors, we need to know where it was applied
from (name of tag) - that way we can check if a declaration was applied
by one of the tag's parents. If it was, then we apply that color by
context taking the background from the nearest parent.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>child</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Element (webcode_tk.cascade_tools.Element)" href="#webcode_tk.cascade_tools.Element">Element</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the child element in question</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ruleset</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the CSS rule being applied</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>name of the file where the styles came from</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>applied_from</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the element that was targetted</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__adjust_child_colors</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">child</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span>
    <span class="n">ruleset</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">applied_by</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;adjusts colors for child of an element.</span>

<span class="sd">    A parent element already had styles applied, so we only need to check</span>
<span class="sd">    to see if the child element is a link or not (as well as the selector)</span>
<span class="sd">    and check the specificity of the ruleset.</span>

<span class="sd">    To help with background colors, we need to know where it was applied</span>
<span class="sd">    from (name of tag) - that way we can check if a declaration was applied</span>
<span class="sd">    by one of the tag&#39;s parents. If it was, then we apply that color by</span>
<span class="sd">    context taking the background from the nearest parent.</span>

<span class="sd">    Args:</span>
<span class="sd">        child: the child element in question</span>
<span class="sd">        ruleset: the CSS rule being applied</span>
<span class="sd">        filename: name of the file where the styles came from</span>
<span class="sd">        applied_from: the name of the element that was targetted</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First adjust direct ancestor</span>

    <span class="c1"># Adjust colors if necessary - if there was a change,</span>
    <span class="c1"># adjust colors for children</span>
    <span class="n">selector</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ruleset</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">is_link_selector</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">is_link_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
    <span class="n">element_name</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span>
    <span class="n">can_inherit</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">is_link_selector</span>
        <span class="ow">and</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span>
        <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_link_selector</span>
        <span class="ow">and</span> <span class="n">element_name</span> <span class="o">!=</span> <span class="s2">&quot;a&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">can_inherit</span><span class="p">:</span>
        <span class="n">declaration</span> <span class="o">=</span> <span class="n">ruleset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
        <span class="n">new_specificity</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_specificity</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">change_styles</span><span class="p">(</span>
            <span class="n">selector</span><span class="p">,</span> <span class="n">declaration</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__adjust_child_colors</span><span class="p">(</span><span class="n">kid</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.__adjust_colors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__adjust_colors</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">applied_by</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">selector_src</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>recursively adjust color where necessary to all elements that
apply.</p>
<p>Step 1: recursively search through children until we find an
element where the selector applies (both by selector and by
specificity).</p>
<p>Step 2: if we find a selector that applies, apply changes to
element AND all children that have same or lower specificity
except a link (unless the selector is a link)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>element</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Element (webcode_tk.cascade_tools.Element)" href="#webcode_tk.cascade_tools.Element">Element</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the element in question.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ruleset</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the ruleset we want to apply.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the file where the styles came from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__adjust_colors</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span>
    <span class="n">ruleset</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">applied_by</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">selector_src</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;recursively adjust color where necessary to all elements that</span>
<span class="sd">    apply.</span>

<span class="sd">    Step 1: recursively search through children until we find an</span>
<span class="sd">    element where the selector applies (both by selector and by</span>
<span class="sd">    specificity).</span>

<span class="sd">    Step 2: if we find a selector that applies, apply changes to</span>
<span class="sd">    element AND all children that have same or lower specificity</span>
<span class="sd">    except a link (unless the selector is a link)</span>

<span class="sd">    Args:</span>
<span class="sd">        element: the element in question.</span>
<span class="sd">        ruleset: the ruleset we want to apply.</span>
<span class="sd">        filename: the file where the styles came from.&quot;&quot;&quot;</span>
    <span class="c1"># If there is a parent, it&#39;s a good time to adjust the direct ancestor</span>
    <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
        <span class="n">bg_sel</span><span class="p">,</span> <span class="n">col_sel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_selectors</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">direct_ancestor</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">ancestors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">direct_ancestor</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">direct_ancestor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">direct_ancestor</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">direct_ancestor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bg_sel</span><span class="p">)</span>
            <span class="n">direct_ancestor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_sel</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">direct_ancestor</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">direct_ancestor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg_sel</span>
            <span class="n">direct_ancestor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_sel</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">direct_ancestor</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">direct_ancestor</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg_sel</span>
            <span class="n">direct_ancestor</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">col_sel</span>

    <span class="c1"># Adjust colors if necessary - if there was a change,</span>
    <span class="c1"># adjust colors for children</span>
    <span class="n">selector</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ruleset</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># does the selector apply to the element?</span>
    <span class="n">selector_applies</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">specificity</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_specificity</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
    <span class="n">declaration</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ruleset</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">property</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">declaration</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">is_background_prop</span> <span class="o">=</span> <span class="s2">&quot;background&quot;</span> <span class="ow">in</span> <span class="nb">property</span>
    <span class="k">if</span> <span class="n">is_background_prop</span><span class="p">:</span>
        <span class="n">old_specificity</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">old_specificity</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
    <span class="n">applies</span> <span class="o">=</span> <span class="n">does_selector_apply</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>
    <span class="n">selector_applies</span> <span class="o">=</span> <span class="p">(</span><span class="n">specificity</span> <span class="o">&gt;=</span> <span class="n">old_specificity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">applies</span>
    <span class="k">if</span> <span class="n">selector_applies</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_background_prop</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">declaration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">declaration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">property</span> <span class="o">==</span> <span class="s2">&quot;background-image&quot;</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">declaration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background-image&quot;</span><span class="p">)</span>
            <span class="n">element</span><span class="o">.</span><span class="n">apply_background_color</span><span class="p">(</span>
                <span class="n">selector</span><span class="p">,</span>
                <span class="nb">property</span><span class="p">,</span>
                <span class="n">value</span><span class="p">,</span>
                <span class="n">old_specificity</span><span class="p">,</span>
                <span class="n">specificity</span><span class="p">,</span>
                <span class="n">filename</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;:hover&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">hover_color</span>
            <span class="k">elif</span> <span class="s2">&quot;:visited&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">visited_color</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">color</span>
            <span class="n">color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">declaration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">)</span>
            <span class="n">color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="n">color</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
            <span class="n">color</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specificity</span>
            <span class="n">color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;directly&quot;</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">element_name</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__adjust_child_colors</span><span class="p">(</span>
                <span class="n">child</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">element_name</span>
            <span class="p">)</span>
    <span class="n">can_inherit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_inherit_styles</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">can_inherit</span> <span class="ow">and</span> <span class="n">applies</span><span class="p">:</span>
        <span class="n">declaration</span> <span class="o">=</span> <span class="n">ruleset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
        <span class="n">new_specificity</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_specificity</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
        <span class="n">element</span><span class="o">.</span><span class="n">change_styles</span><span class="p">(</span>
            <span class="n">selector</span><span class="p">,</span> <span class="n">declaration</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__adjust_colors</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">element</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.__adjust_font_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__adjust_font_size</span><span class="p">(</span><span class="n">element</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>looks for rules that apply and then adjusts accordingly</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>element</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Element (webcode_tk.cascade_tools.Element)" href="#webcode_tk.cascade_tools.Element">Element</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the Element object we wish to adjust.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__adjust_font_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;looks for rules that apply and then adjusts accordingly</span>

<span class="sd">    Args:</span>
<span class="sd">        element: the Element object we wish to adjust.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">######################################################</span>
    <span class="c1"># WHat happens if we first change size to parent size?</span>
    <span class="c1"># element.font_size = element.parent_size</span>
    <span class="c1">######################################################</span>

    <span class="c1"># loop through rules and if they apply, then adjust</span>
    <span class="c1"># adjust for all children</span>
    <span class="k">for</span> <span class="n">selector</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_rules</span><span class="p">:</span>
        <span class="n">selector_applies</span> <span class="o">=</span> <span class="n">does_selector_apply</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>
        <span class="nb">property</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;property&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">property</span> <span class="o">==</span> <span class="s2">&quot;font&quot;</span><span class="p">:</span>
            <span class="n">is_valid_property</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">is_valid_shorthand</span><span class="p">(</span><span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_property</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">property</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="s2">&quot;font-weight&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">selector_applies</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_weight</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
        <span class="n">adjusts_font_size</span> <span class="o">=</span> <span class="nb">property</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="s2">&quot;font-size&quot;</span><span class="p">)</span>
        <span class="n">not_at_rule</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;at_rule&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selector_applies</span> <span class="ow">and</span> <span class="n">adjusts_font_size</span> <span class="ow">and</span> <span class="n">not_at_rule</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
            <span class="n">val</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">split_value_unit</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">computed_size</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">compute_font_size</span><span class="p">(</span>
                <span class="n">val</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">parent_size</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">computed_size</span> <span class="o">!=</span> <span class="n">element</span><span class="o">.</span><span class="n">font_size</span><span class="p">:</span>
                <span class="n">element</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">computed_size</span>
                <span class="c1"># recursively change font size on all children</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">computed_size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.__adjust_largeness" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__adjust_largeness</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>sets the is_large property based on whether it's bold or not
and the computed font size.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__adjust_largeness</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;sets the is_large property based on whether it&#39;s bold or not</span>
<span class="sd">    and the computed font size.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_is_large</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_is_large</span><span class="p">(</span><span class="n">kid</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.__apply_colors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__apply_colors</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>applies all color rules to any elements targeted by styles.</p>
<p>This includes by the cascade and by applying specificity. We'll
loop through all color styles applied from the stylesheets.</p>
<p>After all styles have been applied, do one last check to see
if anything wasn't applied, and then apply the default colors.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__apply_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;applies all color rules to any elements targeted by styles.</span>

<span class="sd">    This includes by the cascade and by applying specificity. We&#39;ll</span>
<span class="sd">    loop through all color styles applied from the stylesheets.</span>

<span class="sd">    After all styles have been applied, do one last check to see</span>
<span class="sd">    if anything wasn&#39;t applied, and then apply the default colors.&quot;&quot;&quot;</span>
    <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_global_colors</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stylesheets</span><span class="p">:</span>
        <span class="n">color_rules</span> <span class="o">=</span> <span class="n">sheet</span><span class="o">.</span><span class="n">color_rulesets</span>
        <span class="k">for</span> <span class="n">ruleset</span> <span class="ow">in</span> <span class="n">color_rules</span><span class="p">:</span>
            <span class="c1"># get filename</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">clerk</span><span class="o">.</span><span class="n">get_file_name</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">href</span><span class="p">)</span>
            <span class="n">selector_source</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">body</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span>
                <span class="n">selector_source</span> <span class="o">=</span> <span class="s2">&quot;body&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Wait, what?&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__adjust_colors</span><span class="p">(</span>
                <span class="n">body</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">selector_src</span><span class="o">=</span><span class="n">selector_source</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.__apply_global_colors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__apply_global_colors</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">global_colors</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;user-agent&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>recursively apply global colors to all elements
except color on links (they remain default)</p>
<p>base case is an element with no children</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>element</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Element (webcode_tk.cascade_tools.Element)" href="#webcode_tk.cascade_tools.Element">Element</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the tag we are applying colors to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>global_colors</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of global color data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the stylesheet where the global styles come from.</p>
              </div>
            </td>
            <td>
                  <code>&#39;user-agent&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__apply_global_colors</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">global_colors</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;user-agent&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;recursively apply global colors to all elements</span>
<span class="sd">    except color on links (they remain default)</span>

<span class="sd">    base case is an element with no children</span>

<span class="sd">    Args:</span>
<span class="sd">        element: the tag we are applying colors to.</span>
<span class="sd">        global_colors: a list of global color data.</span>
<span class="sd">        filename: the stylesheet where the global styles come from.&quot;&quot;&quot;</span>
    <span class="c1"># first apply styles with specificity</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">global_colors</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">global_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">global_colors</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">gc</span> <span class="ow">in</span> <span class="n">global_colors</span><span class="p">:</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
        <span class="n">specificity</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_specificity</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
        <span class="n">gc</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">specificity</span>
        <span class="n">element</span><span class="o">.</span><span class="n">ammend_color_styles</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

        <span class="c1"># loop through all children and call</span>
        <span class="n">children</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">children</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__apply_global_colors</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">gc</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.__build_tree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__build_tree</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Constructs initial tree (recursively?)</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__build_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructs initial tree (recursively?)&quot;&quot;&quot;</span>
    <span class="c1"># Start with the body element, and divide and conquer</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span><span class="s2">&quot;html&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>
    <span class="n">root_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">parent_bg</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span>
        <span class="s2">&quot;body&quot;</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="n">root_id</span><span class="p">,</span> <span class="n">parent_bg</span><span class="p">],</span>
        <span class="n">parent_size</span><span class="o">=</span><span class="n">root_font_size</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">body</span><span class="o">.</span><span class="n">parent_size</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">font_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="n">body_soup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">body</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="n">body_soup</span><span class="o">.</span><span class="n">attrs</span>
    <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
        <span class="n">body</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">compute_font_size</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="n">children</span> <span class="o">=</span> <span class="n">body_soup</span><span class="o">.</span><span class="n">contents</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__get_children</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">children</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.__calculate_root_font_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__calculate_root_font_size</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>checks stylesheets for global font-size settings and adjusts</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__calculate_root_font_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;checks stylesheets for global font-size settings and adjusts&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stylesheets</span><span class="p">:</span>
        <span class="n">font_rules</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_all_font_rules</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">font_rules</span><span class="p">:</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">is_global</span> <span class="o">=</span> <span class="n">selector</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
            <span class="n">not_at_rule</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">rule</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;at_rule&quot;</span><span class="p">)</span>
            <span class="n">is_size_property</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;property&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;font-size&quot;</span>
            <span class="k">if</span> <span class="n">is_global</span> <span class="ow">and</span> <span class="n">is_size_property</span> <span class="ow">and</span> <span class="n">not_at_rule</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="n">size</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">split_value_unit</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">computed_value</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">compute_font_size</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">root_font_size</span> <span class="o">=</span> <span class="n">computed_value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.__get_children" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__get_children</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">soup_contents</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>gets all children of the element and their children from the soup</p>
<p>The soup refers to the bs4 (Beautiful Soup) of the HTML element.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>element</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Element (webcode_tk.cascade_tools.Element)" href="#webcode_tk.cascade_tools.Element">Element</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the parent element.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>soup_contents</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of all items in the bs4 soup</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">soup_contents</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;gets all children of the element and their children from the soup</span>

<span class="sd">    The soup refers to the bs4 (Beautiful Soup) of the HTML element.</span>

<span class="sd">    Args:</span>
<span class="sd">        element: the parent element.</span>
<span class="sd">        soup_contents: a list of all items in the bs4 soup</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">soup_contents</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
        <span class="n">tag_name</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">tag_name</span> <span class="o">==</span> <span class="s2">&quot;script&quot;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">tag_children</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">contents</span>
        <span class="n">tag_attributes</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">attrs</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">element</span><span class="p">)]</span>
        <span class="n">new_element</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span>
            <span class="n">tag_name</span><span class="p">,</span>
            <span class="n">attributes</span><span class="o">=</span><span class="n">tag_attributes</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">parent_size</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
            <span class="n">ancestors</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">ancestors</span><span class="p">,</span>
            <span class="n">tag_contents</span><span class="o">=</span><span class="n">tag</span><span class="o">.</span><span class="n">contents</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__adjust_font_size</span><span class="p">(</span><span class="n">new_element</span><span class="p">)</span>
        <span class="n">element</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_element</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tag_children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">their_kids</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">contents</span>
                <span class="n">kids_attributes</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">attrs</span>
                <span class="k">if</span> <span class="n">kids_attributes</span><span class="p">:</span>
                    <span class="n">kid_element</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">attributes</span><span class="o">=</span><span class="n">kids_attributes</span><span class="p">,</span>
                        <span class="n">parent</span><span class="o">=</span><span class="p">[</span><span class="n">new_element</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">new_element</span><span class="p">)],</span>
                        <span class="n">parent_size</span><span class="o">=</span><span class="n">new_element</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
                        <span class="n">ancestors</span><span class="o">=</span><span class="n">new_element</span><span class="o">.</span><span class="n">ancestors</span><span class="p">,</span>
                        <span class="n">tag_contents</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">contents</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kid_element</span> <span class="o">=</span> <span class="n">Element</span><span class="p">(</span>
                        <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">parent</span><span class="o">=</span><span class="p">[</span><span class="n">new_element</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="n">new_element</span><span class="p">)],</span>
                        <span class="n">parent_size</span><span class="o">=</span><span class="n">new_element</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
                        <span class="n">ancestors</span><span class="o">=</span><span class="n">new_element</span><span class="o">.</span><span class="n">ancestors</span><span class="p">,</span>
                        <span class="n">tag_contents</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">contents</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__adjust_font_size</span><span class="p">(</span><span class="n">kid_element</span><span class="p">)</span>
                <span class="n">new_element</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kid_element</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__get_children</span><span class="p">(</span><span class="n">kid_element</span><span class="p">,</span> <span class="n">their_kids</span><span class="p">)</span>
    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.__get_filename" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__get_filename</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extracts filename from path</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracts filename from path&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">clerk</span><span class="o">.</span><span class="n">get_file_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.__get_soup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__get_soup</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Gets bs4 soup from the file path</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the relative file path to the html document</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__get_soup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets bs4 soup from the file path</span>

<span class="sd">    Args:</span>
<span class="sd">        path: the relative file path to the html document</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">soup</span> <span class="o">=</span> <span class="n">html_tools</span><span class="o">.</span><span class="n">get_html</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.__set_global_colors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__set_global_colors</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>sets global colors to the body element.</p>
<p>This loops through all stylesheets, and at each iteration, it checks
specificity, and if the global colors beat previous specificity, they
get applied. The last of the styles to be applied win, and we return
the body element with global colors applied.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>body</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Element (webcode_tk.cascade_tools.Element)" href="#webcode_tk.cascade_tools.Element">Element</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the Body element with global colors applied.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__set_global_colors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Element</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;sets global colors to the body element.</span>

<span class="sd">    This loops through all stylesheets, and at each iteration, it checks</span>
<span class="sd">    specificity, and if the global colors beat previous specificity, they</span>
<span class="sd">    get applied. The last of the styles to be applied win, and we return</span>
<span class="sd">    the body element with global colors applied.</span>

<span class="sd">    Returns:</span>
<span class="sd">        body: the Body element with global colors applied.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">body</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">sheet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stylesheets</span><span class="p">:</span>
        <span class="n">global_colors</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_global_color_details</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">rulesets</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">clerk</span><span class="o">.</span><span class="n">get_file_name</span><span class="p">(</span><span class="n">sheet</span><span class="o">.</span><span class="n">href</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">global_colors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__apply_global_colors</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">global_colors</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">body</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.can_inherit_styles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">can_inherit_styles</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>returns whether element can get styles through inheritance.</p>
<p>Descendant elements may inherit styles, but only under certain
conditions: The element is not a link (or it is a link but the
selector is selecting it also by type, class, or id). The
element has not had other styles applied to it.</p>
<p>There may be more, but this is it for now.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>element</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Element (webcode_tk.cascade_tools.Element)" href="#webcode_tk.cascade_tools.Element">Element</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the tag that is a descendant of another tag targetted
by the selector.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>selector</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the selector in question.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ruleset</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the ruleset dictionary (the key is the selector, and
the value is the declaration block).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>can_inherit</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether the element should get the inherited
styles or not.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">can_inherit_styles</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns whether element can get styles through inheritance.</span>

<span class="sd">    Descendant elements may inherit styles, but only under certain</span>
<span class="sd">    conditions: The element is not a link (or it is a link but the</span>
<span class="sd">    selector is selecting it also by type, class, or id). The</span>
<span class="sd">    element has not had other styles applied to it.</span>

<span class="sd">    There may be more, but this is it for now.</span>

<span class="sd">    Args:</span>
<span class="sd">        element: the tag that is a descendant of another tag targetted</span>
<span class="sd">            by the selector.</span>
<span class="sd">        selector: the selector in question.</span>
<span class="sd">        ruleset: the ruleset dictionary (the key is the selector, and</span>
<span class="sd">            the value is the declaration block).</span>

<span class="sd">    Returns:</span>
<span class="sd">        can_inherit: whether the element should get the inherited</span>
<span class="sd">            styles or not.&quot;&quot;&quot;</span>
    <span class="n">can_inherit</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">element_name</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span>
    <span class="c1"># is it a link?</span>
    <span class="k">if</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
        <span class="n">is_link_selector</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">is_link_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_link_selector</span><span class="p">:</span>
            <span class="n">can_inherit</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">can_inherit</span>
    <span class="n">selector_applies</span> <span class="o">=</span> <span class="n">does_selector_apply</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">selector_applies</span><span class="p">:</span>
        <span class="n">can_inherit</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">can_inherit</span><span class="p">:</span>
        <span class="c1"># check to see how property has been changed.</span>
        <span class="p">(</span><span class="n">declaration</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ruleset</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="p">(</span><span class="nb">property</span><span class="p">,)</span> <span class="o">=</span> <span class="n">declaration</span>
        <span class="k">if</span> <span class="s2">&quot;background&quot;</span> <span class="ow">in</span> <span class="nb">property</span><span class="p">:</span>
            <span class="n">applied_by</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;applied_by&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">applied_by</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;applied_by&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;selector&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">applied_by</span><span class="p">:</span>
            <span class="n">can_inherit</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">can_inherit</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.extract_selectors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_selectors</span><span class="p">(</span><span class="n">element</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get background color and color selectors</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_selectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get background color and color selectors&quot;&quot;&quot;</span>
    <span class="n">bg_data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">col_data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">Element</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">):</span>
            <span class="n">bg_color</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
            <span class="n">bg_selector</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
            <span class="n">bg_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;bg: </span><span class="si">{</span><span class="n">bg_color</span><span class="si">}</span><span class="s2"> selector: </span><span class="si">{</span><span class="n">bg_selector</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
            <span class="n">col_selector</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
            <span class="n">col_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;color: </span><span class="si">{</span><span class="n">color</span><span class="si">}</span><span class="s2"> selector: </span><span class="si">{</span><span class="n">col_selector</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">bg_data</span><span class="p">,</span> <span class="n">col_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.targets_body" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">targets_body</span><span class="p">(</span><span class="n">ruleset</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>returns whether the ruleset is targetting the body or not.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ruleset</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary of selectors and their declaration blocks.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>body_in_ruleset</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether body is in one of the selectors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">targets_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ruleset</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns whether the ruleset is targetting the body or not.</span>

<span class="sd">    Args:</span>
<span class="sd">        ruleset: a dictionary of selectors and their declaration blocks.</span>

<span class="sd">    Returns:</span>
<span class="sd">        body_in_ruleset: whether body is in one of the selectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">body_in_ruleset</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">selector</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ruleset</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="k">if</span> <span class="s2">&quot;body&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
            <span class="n">body_in_ruleset</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">body_in_ruleset</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.CSSAppliedTree.verify_weight" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">verify_weight</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>verifies whether font weight is set to bold.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">verify_weight</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="nb">property</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;verifies whether font weight is set to bold.&quot;&quot;&quot;</span>
    <span class="n">is_bold</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">property</span> <span class="o">==</span> <span class="s2">&quot;font&quot;</span><span class="p">:</span>
        <span class="n">is_valid_shorthand</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">is_valid_shorthand</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_valid_shorthand</span><span class="p">:</span>
            <span class="n">is_bold</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_bold</span> <span class="o">=</span> <span class="s2">&quot;bold&quot;</span> <span class="ow">in</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">is_bold</span><span class="p">:</span>
        <span class="n">element</span><span class="o">.</span><span class="n">is_bold</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="webcode_tk.cascade_tools.Element" class="doc doc-heading">
            <code>Element</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>



        <p>an element object for each tag in a web page</p>
<p>This will be used by the CSSAppliedTree to represent
the DOM of a web page and will contain the computed
CSS styles based on the styesheet.</p>
<p>A NOTE on background color:
background color is not applied through inheritance. By default,
without being set, the background of all elements is white (or
technically, it's transparent). All elements have a transparent
background (and there is no inheritance).</p>
<p>It is applied through one of two methods:
1. when directly applied to the element
2. through the context of a container element</p>
<p>For example, if the background color of body is set using an ID
selector, and a table inside the body has a different background
color set using a type selector, even though the table's background
has a lower specificity, it will be applied because there is no
inheritance and therefore no specificity to consider.</p>
<p>Therefore, the applied_by will be either "context" or "applied"
Attributes:
    name (str): name of the element.
    children (list): any Elements nested in the tag.
    attributes (list): a list of attributes as dictionaries.
    parent (str): the direct parent of the element.
    ancestors (list): a list of all ancestors (in order of the appearance
        in the DOM)</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Element</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;an element object for each tag in a web page</span>

<span class="sd">    This will be used by the CSSAppliedTree to represent</span>
<span class="sd">    the DOM of a web page and will contain the computed</span>
<span class="sd">    CSS styles based on the styesheet.</span>

<span class="sd">    A NOTE on background color:</span>
<span class="sd">    background color is not applied through inheritance. By default,</span>
<span class="sd">    without being set, the background of all elements is white (or</span>
<span class="sd">    technically, it&#39;s transparent). All elements have a transparent</span>
<span class="sd">    background (and there is no inheritance).</span>

<span class="sd">    It is applied through one of two methods:</span>
<span class="sd">    1. when directly applied to the element</span>
<span class="sd">    2. through the context of a container element</span>

<span class="sd">    For example, if the background color of body is set using an ID</span>
<span class="sd">    selector, and a table inside the body has a different background</span>
<span class="sd">    color set using a type selector, even though the table&#39;s background</span>
<span class="sd">    has a lower specificity, it will be applied because there is no</span>
<span class="sd">    inheritance and therefore no specificity to consider.</span>

<span class="sd">    Therefore, the applied_by will be either &quot;context&quot; or &quot;applied&quot;</span>
<span class="sd">    Attributes:</span>
<span class="sd">        name (str): name of the element.</span>
<span class="sd">        children (list): any Elements nested in the tag.</span>
<span class="sd">        attributes (list): a list of attributes as dictionaries.</span>
<span class="sd">        parent (str): the direct parent of the element.</span>
<span class="sd">        ancestors (list): a list of all ancestors (in order of the appearance</span>
<span class="sd">            in the DOM)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">children</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">attributes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_size</span><span class="o">=</span><span class="n">root_font_size</span><span class="p">,</span>
        <span class="n">ancestors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tag_contents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;#ffffff&quot;</span><span class="p">,</span>
            <span class="s2">&quot;has_alpha&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;computed_value&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;user-agent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;specificity&quot;</span><span class="p">:</span> <span class="s2">&quot;000&quot;</span><span class="p">,</span>
            <span class="s2">&quot;applied_by&quot;</span><span class="p">:</span> <span class="s2">&quot;context&quot;</span><span class="p">,</span>
            <span class="s2">&quot;is_gradient&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;gradient_colors&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;#000000&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;user-agent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;specificity&quot;</span><span class="p">:</span> <span class="s2">&quot;000&quot;</span><span class="p">,</span>
            <span class="s2">&quot;applied_by&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">parent_size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">parent_size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">root_font_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_bold</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_bold</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fonts</span><span class="o">.</span><span class="n">HEADING_SIZES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">HEADING_SIZES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">unit</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">split_value_unit</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="n">fonts</span><span class="o">.</span><span class="n">compute_font_size</span><span class="p">(</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">parent_size</span><span class="p">,</span> <span class="n">name</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_bold</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direct_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tag_contents</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__set_direct_text</span><span class="p">(</span><span class="n">tag_contents</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_direct_text</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direct_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visited_color</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;specificity&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;applied_by&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;specificity&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;applied_by&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;specificity&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;applied_by&quot;</span><span class="p">:</span> <span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sheet&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;specificity&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;applied_by&quot;</span><span class="p">:</span> <span class="s2">&quot;context&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_large</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_link</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contrast_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mf">21.0</span><span class="p">,</span>
            <span class="s2">&quot;normal_aaa&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;normal_aa&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;large_aaa&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;large_aa&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hover_contrast_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mf">21.0</span><span class="p">,</span>
            <span class="s2">&quot;normal_aaa&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;normal_aa&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;large_aaa&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;large_aa&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visited_contrast_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;normal_aaa&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;normal_aa&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;large_aaa&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;large_aa&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_link_color</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_contrast_data</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">children</span> <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_size</span> <span class="o">=</span> <span class="n">parent_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span> <span class="o">=</span> <span class="n">ancestors</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">ancestors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__set_direct_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get only text not in a tag&quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">):</span>
                <span class="n">new_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_text</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="n">new_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direct_text</span> <span class="o">=</span> <span class="n">text</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__set_link_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_link_color</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visited_color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_link_visited</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visited_color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;user-agent&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visited_color</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;000&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_global_background</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;user-agent&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;000&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;context&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ammend_color_styles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_styles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;adjust color styles based on specificity.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_styles: the new styles we want to apply.</span>
<span class="sd">            filename: the stylesheet the styles came from.&quot;&quot;&quot;</span>

        <span class="c1"># are we even targetting color or bg color</span>
        <span class="n">targets_color</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">))</span>
        <span class="n">targets_bg_color</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">))</span>

        <span class="c1"># get relevant specificity</span>
        <span class="n">new_specificity</span> <span class="o">=</span> <span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
        <span class="n">col_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>

        <span class="c1"># Check for overrides</span>
        <span class="n">color_has_override</span> <span class="o">=</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">col_specificity</span>

        <span class="c1"># change color if applies</span>
        <span class="n">selector</span> <span class="o">=</span> <span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
        <span class="n">not_a_link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;a&quot;</span>
        <span class="k">if</span> <span class="n">not_a_link</span><span class="p">:</span>
            <span class="n">hover_selector</span> <span class="o">=</span> <span class="s2">&quot;:hover&quot;</span> <span class="ow">in</span> <span class="n">selector</span>
            <span class="n">visited_selector</span> <span class="o">=</span> <span class="s2">&quot;:visited&quot;</span> <span class="ow">in</span> <span class="n">selector</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hover_selector</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">visited_selector</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">targets_color</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">color_has_override</span><span class="p">:</span>
                        <span class="n">col</span> <span class="o">=</span> <span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">col</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">targets_bg_color</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ammend_bg_color</span><span class="p">(</span>
                        <span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">),</span>
                        <span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">),</span>
                        <span class="n">new_specificity</span><span class="p">,</span>
                        <span class="n">filename</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="c1"># get contrast for color &amp; bg_color</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_contrast_data</span><span class="p">(</span><span class="s2">&quot;standard&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># be sure to change at least the background color for pseudo-states</span>
            <span class="k">if</span> <span class="n">targets_bg_color</span><span class="p">:</span>
                <span class="c1"># check hover background</span>
                <span class="n">hover_bg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="n">hover_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
                <span class="n">new_bg</span> <span class="o">=</span> <span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">hover_bg</span> <span class="ow">or</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">hover_specificity</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_bg</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>

                <span class="c1"># check visited background</span>
                <span class="n">visited_bg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="n">visited_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;specificity&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">visited_bg</span> <span class="ow">or</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">visited_specificity</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_bg</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ammend_bg_color</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bg_color</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">new_selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">new_specificity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ammends the bg color based on the selector and specficity.</span>

<span class="sd">        Args:</span>
<span class="sd">            bg_color: the new bg color value.</span>
<span class="sd">            new_selector: the new selector.</span>
<span class="sd">            new_specificity: the specificity of the new selector.</span>
<span class="sd">            filename: the name of the file that is applying the styles.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">old_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
        <span class="n">bg_has_override</span> <span class="o">=</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">old_specificity</span>

        <span class="c1"># Is the element is targetted directly.</span>
        <span class="n">targeted_directly</span> <span class="o">=</span> <span class="n">targets_element_directly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_selector</span><span class="p">)</span>

        <span class="c1"># Did the previous bg get set directly?</span>
        <span class="n">bg_was_directly_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;directly&quot;</span>

        <span class="k">if</span> <span class="n">targeted_directly</span><span class="p">:</span>
            <span class="c1"># don&#39;t apply if it was previously set with a higher specificity</span>
            <span class="k">if</span> <span class="n">bg_was_directly_set</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">bg_has_override</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># set new values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;directly&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg_color</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If it was not directly set, we can change it</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_was_directly_set</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg_color</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                        <span class="n">kid</span><span class="o">.</span><span class="n">ammend_bg_color</span><span class="p">(</span>
                            <span class="n">bg_color</span><span class="p">,</span> <span class="n">new_selector</span><span class="p">,</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span>
                        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_contrast_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get color contrast for the type specified</span>

<span class="sd">        contrast data could be for one of three possibile types:</span>
<span class="sd">        * default: this is when all elements get their default values,</span>
<span class="sd">        * standard: this is for checking contrast between color and</span>
<span class="sd">        background color,</span>
<span class="sd">        * hover: for the hover pseudoselector - could be applied to any</span>
<span class="sd">        element (not just hyperlinks)</span>
<span class="sd">        * visited: for visited links</span>

<span class="sd">        Args:</span>
<span class="sd">            type: the type of color contrast.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">col</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">anc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">color_details</span> <span class="o">=</span> <span class="n">anc</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="n">color_details</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="s2">&quot;#&quot;</span> <span class="o">==</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="s2">&quot;rgb&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="s2">&quot;hsl&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                        <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">col</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>
                    <span class="k">if</span> <span class="n">color</span><span class="o">.</span><span class="n">is_color_value</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
                        <span class="k">break</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">color</span><span class="o">.</span><span class="n">is_gradient</span><span class="p">(</span><span class="n">bg</span><span class="p">):</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_color_contrast_with_gradients</span><span class="p">(</span>
                <span class="n">col</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span>
            <span class="p">)</span>
            <span class="c1"># Set bg to composite color with lowest contrast ratio</span>
            <span class="n">bg</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">has_alpha</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">has_alpha</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;has_alpha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;computed_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg</span>

        <span class="n">hexc</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_hex</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="n">hexbg</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_hex</span><span class="p">(</span><span class="n">bg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__build_contrast_report</span><span class="p">(</span><span class="n">hexc</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span> <span class="ow">and</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;visited&quot;</span><span class="p">:</span>
            <span class="n">vcol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
            <span class="n">hexv</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_hex</span><span class="p">(</span><span class="n">vcol</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__build_visited_contrast_report</span><span class="p">(</span><span class="n">hexv</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;hover&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;directly&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__build_contrast_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hexc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;creates a full contrast report for Element.</span>

<span class="sd">        Args:</span>
<span class="sd">            hexc: the hex code for the color value.</span>
<span class="sd">            hexbg: the hex code for the background color.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">link_contrast</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_color_contrast_report</span><span class="p">(</span><span class="n">hexc</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span>
        <span class="n">link_ratio</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">contrast_ratio</span><span class="p">(</span><span class="n">hexc</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">contrast_data</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link_ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contrast_data</span><span class="p">[</span><span class="s2">&quot;normal_aaa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Normal AAA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contrast_data</span><span class="p">[</span><span class="s2">&quot;normal_aa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Normal AA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contrast_data</span><span class="p">[</span><span class="s2">&quot;large_aaa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Large AAA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__build_visited_contrast_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hexc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;builds contrast report for visited color settings.</span>

<span class="sd">        This applies only for anchor tags as they are the only ones with a</span>
<span class="sd">        visited property.</span>

<span class="sd">        Args:</span>
<span class="sd">            hexc: the hex code for the color value.</span>
<span class="sd">            hexbg: the hex code for the background color.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">link_contrast</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_color_contrast_report</span><span class="p">(</span><span class="n">hexc</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span>
        <span class="n">link_ratio</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">contrast_ratio</span><span class="p">(</span><span class="n">hexc</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">visited_contrast_data</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link_ratio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visited_contrast_data</span><span class="p">[</span><span class="s2">&quot;normal_aaa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Normal AAA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visited_contrast_data</span><span class="p">[</span><span class="s2">&quot;normal_aa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Normal AA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visited_contrast_data</span><span class="p">[</span><span class="s2">&quot;large_aaa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Large AAA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visited_contrast_data</span><span class="p">[</span><span class="s2">&quot;large_aa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Large AA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">change_styles</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">declaration</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">new_specificity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;change styles and apply them to all descendants</span>

<span class="sd">        Args:</span>
<span class="sd">            selector: the selector used to make a change</span>
<span class="sd">            declaration: the declaration (property and value)</span>
<span class="sd">            new_specificity: the specificity value of the selector</span>
<span class="sd">            filename: file where the styles come from.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">hover_selector</span> <span class="o">=</span> <span class="s2">&quot;a:hover&quot;</span> <span class="ow">in</span> <span class="n">selector</span>

        <span class="k">for</span> <span class="nb">property</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">declaration</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">hover_selector</span><span class="p">:</span>
                <span class="p">(</span><span class="n">prop</span><span class="p">,)</span> <span class="o">=</span> <span class="n">declaration</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">declaration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;background&quot;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span>
                    <span class="n">specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">specificity</span> <span class="ow">or</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">specificity</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;selector: &quot;</span> <span class="o">+</span> <span class="n">selector</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">specificity</span> <span class="ow">or</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">specificity</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s2">&quot;selector: &quot;</span> <span class="o">+</span> <span class="n">selector</span>
                        <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">property</span> <span class="o">==</span> <span class="s2">&quot;background&quot;</span> <span class="ow">or</span> <span class="nb">property</span> <span class="o">==</span> <span class="s2">&quot;background-color&quot;</span><span class="p">:</span>
                <span class="n">old_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">apply_background_color</span><span class="p">(</span>
                    <span class="n">selector</span><span class="p">,</span>
                    <span class="nb">property</span><span class="p">,</span>
                    <span class="n">val</span><span class="p">,</span>
                    <span class="n">old_specificity</span><span class="p">,</span>
                    <span class="n">new_specificity</span><span class="p">,</span>
                    <span class="n">filename</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">property</span> <span class="o">==</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span>
                <span class="n">old_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">old_specificity</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hover_selector</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_contrast_data</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">child</span><span class="o">.</span><span class="n">change_child_styles</span><span class="p">(</span>
                    <span class="n">selector</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span>
                <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">change_child_styles</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="nb">property</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">val</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">new_specificity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;changes child styles based on inheritance.</span>

<span class="sd">        Styles were changed by an ancestor, so we are passing down styles</span>
<span class="sd">        through inheritance, and so we must only change styles if they weren&#39;t</span>
<span class="sd">        already set directly.</span>

<span class="sd">        Args:</span>
<span class="sd">            selector: selector being used.</span>
<span class="sd">            property: property being passed down.</span>
<span class="sd">            val: value being passed down</span>
<span class="sd">            new_specificity: in case it matters (selector should also be</span>
<span class="sd">                targetting in some way).</span>
<span class="sd">            filename: the file where the styles came from.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># has the element already had same property targetted previously?</span>
        <span class="n">already_applied</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">been_applied</span><span class="p">(</span><span class="nb">property</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">already_applied</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># If it&#39;s a link, it shouldn&#39;t be applied unless it&#39;s a link selector</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
            <span class="n">link_selector</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">is_link_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">link_selector</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="c1"># is the selector targetting the tag directly (by type, id, or class)</span>
        <span class="n">targets_directly</span> <span class="o">=</span> <span class="n">does_selector_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>

        <span class="c1"># if it targets directly, then look to specificity</span>
        <span class="k">if</span> <span class="n">targets_directly</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;background&quot;</span> <span class="ow">in</span> <span class="nb">property</span><span class="p">:</span>
                <span class="n">old_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">old_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">old_specificity</span> <span class="o">&gt;</span> <span class="n">new_specificity</span><span class="p">:</span>
                <span class="c1"># new specificity loses - nothing to add here</span>
                <span class="k">return</span>

        <span class="c1"># Apply the styles</span>
        <span class="k">if</span> <span class="s2">&quot;background&quot;</span> <span class="ow">in</span> <span class="nb">property</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ammend_bg_color</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="k">if</span> <span class="n">targets_directly</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;selector: &quot;</span> <span class="o">+</span> <span class="n">selector</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;inheritance&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">directly_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns whether selector directly targets tag.</span>

<span class="sd">        Checks all possible selector types</span>

<span class="sd">        Args:</span>
<span class="sd">            selector: the selector in question.</span>

<span class="sd">        Returns:</span>
<span class="sd">            targets: a boolean value (does the selector target the tag?)&quot;&quot;&quot;</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">element_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="n">selector</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
            <span class="n">selector_type</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_selector_type</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;descendant_selector&quot;</span><span class="p">:</span>
                <span class="n">selectors</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;grouped_selector&quot;</span><span class="p">:</span>
                <span class="n">selectors</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">sel</span><span class="p">:</span>
                        <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
            <span class="k">elif</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;id_selector&quot;</span><span class="p">:</span>
                <span class="c1"># If it&#39;s an id selector, the id attribute must be there.</span>
                <span class="n">id_value</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span> <span class="n">abc</span><span class="o">.</span><span class="n">ItemsView</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span>
                                <span class="n">element_id</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">element_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="n">element_id</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">id_value</span> <span class="o">==</span> <span class="n">element_id</span><span class="p">:</span>
                    <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;advanced_link_selector&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;:hover&quot;</span> <span class="ow">in</span> <span class="n">selector</span> <span class="ow">and</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
                    <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check for attribute selector</span>
            <span class="n">selector_type</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_selector_type</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;class_selector&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;class&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">selector</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                                <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">break</span>
                <span class="k">if</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;id_selector&quot;</span><span class="p">:</span>
                    <span class="c1"># NOTE: testing has not uncovered this state</span>
                    <span class="c1"># we&#39;re keeping it here just in case</span>
                    <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">selector</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                                <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">break</span>
        <span class="k">return</span> <span class="n">targets</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">been_applied</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">property</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;has this property already had a style directly applied?</span>

<span class="sd">        Args:</span>
<span class="sd">            property: the property in question.</span>

<span class="sd">        Returns:</span>
<span class="sd">            applied: whether it has had a style applied or not.&quot;&quot;&quot;</span>
        <span class="n">applied</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;background&quot;</span> <span class="ow">in</span> <span class="nb">property</span><span class="p">:</span>
            <span class="n">applied_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;applied_by&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">applied_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;applied_by&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">applied_by</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;context&quot;</span><span class="p">,</span> <span class="s2">&quot;inheritance&quot;</span><span class="p">]:</span>
            <span class="n">applied</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">applied</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_background_color</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="nb">property</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">val</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">old_specificity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">new_specificity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Applies background color by context or directly.</span>

<span class="sd">        Args:</span>
<span class="sd">            selector: the selector of the new styles.</span>
<span class="sd">            property: the property of the new styles.</span>
<span class="sd">            val: the value of the new styles.</span>
<span class="sd">            old_specificity: the specificity rank of styles currently in use.</span>
<span class="sd">            new_specificity: the specificity of the new selector.</span>
<span class="sd">            filename: the file (html or css) that applied the styles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Are we directly targeted or not?</span>
        <span class="n">directly_targeted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directly_targets</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
        <span class="n">previously_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;applied_by&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;directly&quot;</span>
        <span class="n">bg_gradient</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">is_gradient</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="c1"># If directly, check specificity</span>
        <span class="k">if</span> <span class="n">directly_targeted</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">previously_set</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">new_specificity</span> <span class="o">&lt;</span> <span class="n">old_specificity</span><span class="p">:</span>
                    <span class="k">return</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">bg_gradient</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;is_gradient&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="n">details</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_color_contrast_with_gradients</span><span class="p">(</span>
                    <span class="n">c</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span>
                <span class="p">)</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_gradient_colors</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

                <span class="c1"># Set gradient colors with highest and lowest contrast</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;best_contrast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;worst_contrast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">process_gradient_data</span><span class="p">(</span><span class="n">details</span><span class="p">,</span> <span class="n">bg_dict</span><span class="p">):</span>
                    <span class="n">contrast_ratio</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>
                    <span class="n">is_bold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bold</span>
                    <span class="n">results</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_contrast_results_from_ratio</span><span class="p">(</span>
                        <span class="n">contrast_ratio</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">is_bold</span>
                    <span class="p">)</span>
                    <span class="n">has_alpha</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">has_alpha</span><span class="p">:</span>
                        <span class="n">bg_dict</span><span class="p">[</span><span class="s2">&quot;has_alpha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">has_alpha</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;has_alpha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;computed_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                        <span class="n">bg_dict</span><span class="p">[</span><span class="s2">&quot;computed_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">bg_dict</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">bg_dict</span><span class="p">[</span><span class="s2">&quot;contrast_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">bg_dict</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span>

                <span class="n">best</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">worst</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">process_gradient_data</span><span class="p">(</span>
                    <span class="n">best</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;best_contrast&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">process_gradient_data</span><span class="p">(</span>
                    <span class="n">worst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;worst_contrast&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;gradient_colors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span>
            <span class="c1"># set color, specificity, and directly applied</span>
            <span class="k">if</span> <span class="s2">&quot;:hover&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
                <span class="n">background_color_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span>
            <span class="k">elif</span> <span class="s2">&quot;:visited&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
                <span class="n">background_color_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">background_color_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span>
            <span class="n">background_color_dict</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">background_color_dict</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="n">background_color_dict</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
            <span class="n">background_color_dict</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;directly&quot;</span>
            <span class="n">background_color_dict</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">previously_set</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;context&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.Element.__build_contrast_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__build_contrast_report</span><span class="p">(</span><span class="n">hexc</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>creates a full contrast report for Element.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hexc</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the hex code for the color value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hexbg</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the hex code for the background color.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__build_contrast_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hexc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;creates a full contrast report for Element.</span>

<span class="sd">    Args:</span>
<span class="sd">        hexc: the hex code for the color value.</span>
<span class="sd">        hexbg: the hex code for the background color.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_contrast</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_color_contrast_report</span><span class="p">(</span><span class="n">hexc</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span>
    <span class="n">link_ratio</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">contrast_ratio</span><span class="p">(</span><span class="n">hexc</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">contrast_data</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link_ratio</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">contrast_data</span><span class="p">[</span><span class="s2">&quot;normal_aaa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
        <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Normal AAA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">contrast_data</span><span class="p">[</span><span class="s2">&quot;normal_aa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
        <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Normal AA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">contrast_data</span><span class="p">[</span><span class="s2">&quot;large_aaa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
        <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Large AAA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.Element.__build_visited_contrast_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__build_visited_contrast_report</span><span class="p">(</span><span class="n">hexc</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>builds contrast report for visited color settings.</p>
<p>This applies only for anchor tags as they are the only ones with a
visited property.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hexc</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the hex code for the color value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hexbg</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the hex code for the background color.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__build_visited_contrast_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hexc</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;builds contrast report for visited color settings.</span>

<span class="sd">    This applies only for anchor tags as they are the only ones with a</span>
<span class="sd">    visited property.</span>

<span class="sd">    Args:</span>
<span class="sd">        hexc: the hex code for the color value.</span>
<span class="sd">        hexbg: the hex code for the background color.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_contrast</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_color_contrast_report</span><span class="p">(</span><span class="n">hexc</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span>
    <span class="n">link_ratio</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">contrast_ratio</span><span class="p">(</span><span class="n">hexc</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">visited_contrast_data</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link_ratio</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">visited_contrast_data</span><span class="p">[</span><span class="s2">&quot;normal_aaa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
        <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Normal AAA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">visited_contrast_data</span><span class="p">[</span><span class="s2">&quot;normal_aa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
        <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Normal AA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">visited_contrast_data</span><span class="p">[</span><span class="s2">&quot;large_aaa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
        <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Large AAA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">visited_contrast_data</span><span class="p">[</span><span class="s2">&quot;large_aa&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
        <span class="n">link_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Large AA&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Pass&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.Element.__set_direct_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__set_direct_text</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>get only text not in a tag</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__set_direct_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get only text not in a tag&quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">NavigableString</span><span class="p">):</span>
            <span class="n">new_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_text</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="n">new_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">direct_text</span> <span class="o">=</span> <span class="n">text</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.Element.ammend_bg_color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ammend_bg_color</span><span class="p">(</span><span class="n">bg_color</span><span class="p">,</span> <span class="n">new_selector</span><span class="p">,</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>ammends the bg color based on the selector and specficity.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bg_color</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the new bg color value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_selector</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the new selector.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_specificity</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the specificity of the new selector.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the name of the file that is applying the styles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ammend_bg_color</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bg_color</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">new_selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">new_specificity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ammends the bg color based on the selector and specficity.</span>

<span class="sd">    Args:</span>
<span class="sd">        bg_color: the new bg color value.</span>
<span class="sd">        new_selector: the new selector.</span>
<span class="sd">        new_specificity: the specificity of the new selector.</span>
<span class="sd">        filename: the name of the file that is applying the styles.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">old_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
    <span class="n">bg_has_override</span> <span class="o">=</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">old_specificity</span>

    <span class="c1"># Is the element is targetted directly.</span>
    <span class="n">targeted_directly</span> <span class="o">=</span> <span class="n">targets_element_directly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_selector</span><span class="p">)</span>

    <span class="c1"># Did the previous bg get set directly?</span>
    <span class="n">bg_was_directly_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;directly&quot;</span>

    <span class="k">if</span> <span class="n">targeted_directly</span><span class="p">:</span>
        <span class="c1"># don&#39;t apply if it was previously set with a higher specificity</span>
        <span class="k">if</span> <span class="n">bg_was_directly_set</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">bg_has_override</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># set new values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;directly&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If it was not directly set, we can change it</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bg_was_directly_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg_color</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
                    <span class="n">kid</span><span class="o">.</span><span class="n">ammend_bg_color</span><span class="p">(</span>
                        <span class="n">bg_color</span><span class="p">,</span> <span class="n">new_selector</span><span class="p">,</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span>
                    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.Element.ammend_color_styles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ammend_color_styles</span><span class="p">(</span><span class="n">new_styles</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>adjust color styles based on specificity.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>new_styles</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the new styles we want to apply.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the stylesheet the styles came from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ammend_color_styles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_styles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;adjust color styles based on specificity.</span>

<span class="sd">    Args:</span>
<span class="sd">        new_styles: the new styles we want to apply.</span>
<span class="sd">        filename: the stylesheet the styles came from.&quot;&quot;&quot;</span>

    <span class="c1"># are we even targetting color or bg color</span>
    <span class="n">targets_color</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">))</span>
    <span class="n">targets_bg_color</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">))</span>

    <span class="c1"># get relevant specificity</span>
    <span class="n">new_specificity</span> <span class="o">=</span> <span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
    <span class="n">col_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>

    <span class="c1"># Check for overrides</span>
    <span class="n">color_has_override</span> <span class="o">=</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">col_specificity</span>

    <span class="c1"># change color if applies</span>
    <span class="n">selector</span> <span class="o">=</span> <span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
    <span class="n">not_a_link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;a&quot;</span>
    <span class="k">if</span> <span class="n">not_a_link</span><span class="p">:</span>
        <span class="n">hover_selector</span> <span class="o">=</span> <span class="s2">&quot;:hover&quot;</span> <span class="ow">in</span> <span class="n">selector</span>
        <span class="n">visited_selector</span> <span class="o">=</span> <span class="s2">&quot;:visited&quot;</span> <span class="ow">in</span> <span class="n">selector</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hover_selector</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">visited_selector</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">targets_color</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">color_has_override</span><span class="p">:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">col</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">targets_bg_color</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ammend_bg_color</span><span class="p">(</span>
                    <span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">),</span>
                    <span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">),</span>
                    <span class="n">new_specificity</span><span class="p">,</span>
                    <span class="n">filename</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># get contrast for color &amp; bg_color</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_contrast_data</span><span class="p">(</span><span class="s2">&quot;standard&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># be sure to change at least the background color for pseudo-states</span>
        <span class="k">if</span> <span class="n">targets_bg_color</span><span class="p">:</span>
            <span class="c1"># check hover background</span>
            <span class="n">hover_bg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
            <span class="n">hover_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
            <span class="n">new_bg</span> <span class="o">=</span> <span class="n">new_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hover_bg</span> <span class="ow">or</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">hover_specificity</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_bg</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>

            <span class="c1"># check visited background</span>
            <span class="n">visited_bg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
            <span class="n">visited_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;specificity&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">visited_bg</span> <span class="ow">or</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">visited_specificity</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_bg</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.Element.apply_background_color" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_background_color</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">old_specificity</span><span class="p">,</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Applies background color by context or directly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>selector</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the selector of the new styles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>property</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the property of the new styles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the value of the new styles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>old_specificity</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the specificity rank of styles currently in use.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_specificity</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the specificity of the new selector.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the file (html or css) that applied the styles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply_background_color</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="nb">property</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">val</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">old_specificity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">new_specificity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies background color by context or directly.</span>

<span class="sd">    Args:</span>
<span class="sd">        selector: the selector of the new styles.</span>
<span class="sd">        property: the property of the new styles.</span>
<span class="sd">        val: the value of the new styles.</span>
<span class="sd">        old_specificity: the specificity rank of styles currently in use.</span>
<span class="sd">        new_specificity: the specificity of the new selector.</span>
<span class="sd">        filename: the file (html or css) that applied the styles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Are we directly targeted or not?</span>
    <span class="n">directly_targeted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directly_targets</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
    <span class="n">previously_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;applied_by&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;directly&quot;</span>
    <span class="n">bg_gradient</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">is_gradient</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="c1"># If directly, check specificity</span>
    <span class="k">if</span> <span class="n">directly_targeted</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">previously_set</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">new_specificity</span> <span class="o">&lt;</span> <span class="n">old_specificity</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">bg_gradient</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;is_gradient&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
            <span class="n">details</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_color_contrast_with_gradients</span><span class="p">(</span>
                <span class="n">c</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span>
            <span class="p">)</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_gradient_colors</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

            <span class="c1"># Set gradient colors with highest and lowest contrast</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;best_contrast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;worst_contrast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">process_gradient_data</span><span class="p">(</span><span class="n">details</span><span class="p">,</span> <span class="n">bg_dict</span><span class="p">):</span>
                <span class="n">contrast_ratio</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_size</span>
                <span class="n">is_bold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_bold</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_contrast_results_from_ratio</span><span class="p">(</span>
                    <span class="n">contrast_ratio</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">is_bold</span>
                <span class="p">)</span>
                <span class="n">has_alpha</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">has_alpha</span><span class="p">:</span>
                    <span class="n">bg_dict</span><span class="p">[</span><span class="s2">&quot;has_alpha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">has_alpha</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;has_alpha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;computed_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">bg_dict</span><span class="p">[</span><span class="s2">&quot;computed_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bg_dict</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">bg_dict</span><span class="p">[</span><span class="s2">&quot;contrast_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">bg_dict</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span>

            <span class="n">best</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">worst</span> <span class="o">=</span> <span class="n">details</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">process_gradient_data</span><span class="p">(</span>
                <span class="n">best</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;best_contrast&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">process_gradient_data</span><span class="p">(</span>
                <span class="n">worst</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;worst_contrast&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;gradient_colors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span>
        <span class="c1"># set color, specificity, and directly applied</span>
        <span class="k">if</span> <span class="s2">&quot;:hover&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
            <span class="n">background_color_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span>
        <span class="k">elif</span> <span class="s2">&quot;:visited&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
            <span class="n">background_color_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited_background</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">background_color_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span>
        <span class="n">background_color_dict</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="n">background_color_dict</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">background_color_dict</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
        <span class="n">background_color_dict</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;directly&quot;</span>
        <span class="n">background_color_dict</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">previously_set</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;context&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.Element.been_applied" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">been_applied</span><span class="p">(</span><span class="nb">property</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>has this property already had a style directly applied?</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>property</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the property in question.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>applied</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether it has had a style applied or not.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">been_applied</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">property</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;has this property already had a style directly applied?</span>

<span class="sd">    Args:</span>
<span class="sd">        property: the property in question.</span>

<span class="sd">    Returns:</span>
<span class="sd">        applied: whether it has had a style applied or not.&quot;&quot;&quot;</span>
    <span class="n">applied</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="s2">&quot;background&quot;</span> <span class="ow">in</span> <span class="nb">property</span><span class="p">:</span>
        <span class="n">applied_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;applied_by&quot;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">applied_by</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;applied_by&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">applied_by</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;context&quot;</span><span class="p">,</span> <span class="s2">&quot;inheritance&quot;</span><span class="p">]:</span>
        <span class="n">applied</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">applied</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.Element.change_child_styles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">change_child_styles</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>changes child styles based on inheritance.</p>
<p>Styles were changed by an ancestor, so we are passing down styles
through inheritance, and so we must only change styles if they weren't
already set directly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>selector</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>selector being used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>property</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>property being passed down.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>val</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>value being passed down</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_specificity</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>in case it matters (selector should also be
targetting in some way).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the file where the styles came from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">change_child_styles</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="nb">property</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">val</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">new_specificity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;changes child styles based on inheritance.</span>

<span class="sd">    Styles were changed by an ancestor, so we are passing down styles</span>
<span class="sd">    through inheritance, and so we must only change styles if they weren&#39;t</span>
<span class="sd">    already set directly.</span>

<span class="sd">    Args:</span>
<span class="sd">        selector: selector being used.</span>
<span class="sd">        property: property being passed down.</span>
<span class="sd">        val: value being passed down</span>
<span class="sd">        new_specificity: in case it matters (selector should also be</span>
<span class="sd">            targetting in some way).</span>
<span class="sd">        filename: the file where the styles came from.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># has the element already had same property targetted previously?</span>
    <span class="n">already_applied</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">been_applied</span><span class="p">(</span><span class="nb">property</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">already_applied</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># If it&#39;s a link, it shouldn&#39;t be applied unless it&#39;s a link selector</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
        <span class="n">link_selector</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">is_link_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">link_selector</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="c1"># is the selector targetting the tag directly (by type, id, or class)</span>
    <span class="n">targets_directly</span> <span class="o">=</span> <span class="n">does_selector_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>

    <span class="c1"># if it targets directly, then look to specificity</span>
    <span class="k">if</span> <span class="n">targets_directly</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;background&quot;</span> <span class="ow">in</span> <span class="nb">property</span><span class="p">:</span>
            <span class="n">old_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">old_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">old_specificity</span> <span class="o">&gt;</span> <span class="n">new_specificity</span><span class="p">:</span>
            <span class="c1"># new specificity loses - nothing to add here</span>
            <span class="k">return</span>

    <span class="c1"># Apply the styles</span>
    <span class="k">if</span> <span class="s2">&quot;background&quot;</span> <span class="ow">in</span> <span class="nb">property</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ammend_bg_color</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="n">targets_directly</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;selector: &quot;</span> <span class="o">+</span> <span class="n">selector</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;inheritance&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.Element.change_styles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">change_styles</span><span class="p">(</span><span class="n">selector</span><span class="p">,</span> <span class="n">declaration</span><span class="p">,</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>change styles and apply them to all descendants</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>selector</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the selector used to make a change</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>declaration</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the declaration (property and value)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_specificity</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the specificity value of the selector</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filename</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>file where the styles come from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">change_styles</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">declaration</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">new_specificity</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;change styles and apply them to all descendants</span>

<span class="sd">    Args:</span>
<span class="sd">        selector: the selector used to make a change</span>
<span class="sd">        declaration: the declaration (property and value)</span>
<span class="sd">        new_specificity: the specificity value of the selector</span>
<span class="sd">        filename: file where the styles come from.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">hover_selector</span> <span class="o">=</span> <span class="s2">&quot;a:hover&quot;</span> <span class="ow">in</span> <span class="n">selector</span>

    <span class="k">for</span> <span class="nb">property</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">declaration</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">hover_selector</span><span class="p">:</span>
            <span class="p">(</span><span class="n">prop</span><span class="p">,)</span> <span class="o">=</span> <span class="n">declaration</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">declaration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;background&quot;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">:</span>
                <span class="n">specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">specificity</span> <span class="ow">or</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">specificity</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hover_background</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;selector: &quot;</span> <span class="o">+</span> <span class="n">selector</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">specificity</span> <span class="ow">or</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">specificity</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;selector: &quot;</span> <span class="o">+</span> <span class="n">selector</span>
                    <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">property</span> <span class="o">==</span> <span class="s2">&quot;background&quot;</span> <span class="ow">or</span> <span class="nb">property</span> <span class="o">==</span> <span class="s2">&quot;background-color&quot;</span><span class="p">:</span>
            <span class="n">old_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_background_color</span><span class="p">(</span>
                <span class="n">selector</span><span class="p">,</span>
                <span class="nb">property</span><span class="p">,</span>
                <span class="n">val</span><span class="p">,</span>
                <span class="n">old_specificity</span><span class="p">,</span>
                <span class="n">new_specificity</span><span class="p">,</span>
                <span class="n">filename</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">property</span> <span class="o">==</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span>
            <span class="n">old_specificity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;specificity&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_specificity</span> <span class="o">&gt;=</span> <span class="n">old_specificity</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;sheet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;selector&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selector</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">[</span><span class="s2">&quot;specificity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_specificity</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hover_selector</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_contrast_data</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">change_child_styles</span><span class="p">(</span>
                <span class="n">selector</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">new_specificity</span><span class="p">,</span> <span class="n">filename</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.Element.directly_targets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">directly_targets</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>returns whether selector directly targets tag.</p>
<p>Checks all possible selector types</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>selector</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the selector in question.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>targets</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a boolean value (does the selector target the tag?)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">directly_targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns whether selector directly targets tag.</span>

<span class="sd">    Checks all possible selector types</span>

<span class="sd">    Args:</span>
<span class="sd">        selector: the selector in question.</span>

<span class="sd">    Returns:</span>
<span class="sd">        targets: a boolean value (does the selector target the tag?)&quot;&quot;&quot;</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">element_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">if</span> <span class="n">selector</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
        <span class="n">selector_type</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_selector_type</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;descendant_selector&quot;</span><span class="p">:</span>
            <span class="n">selectors</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;grouped_selector&quot;</span><span class="p">:</span>
            <span class="n">selectors</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">element_name</span> <span class="ow">in</span> <span class="n">sel</span><span class="p">:</span>
                    <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
        <span class="k">elif</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;id_selector&quot;</span><span class="p">:</span>
            <span class="c1"># If it&#39;s an id selector, the id attribute must be there.</span>
            <span class="n">id_value</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span> <span class="n">abc</span><span class="o">.</span><span class="n">ItemsView</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span>
                            <span class="n">element_id</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">element_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">element_id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">id_value</span> <span class="o">==</span> <span class="n">element_id</span><span class="p">:</span>
                <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;advanced_link_selector&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;:hover&quot;</span> <span class="ow">in</span> <span class="n">selector</span> <span class="ow">and</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
                <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># check for attribute selector</span>
        <span class="n">selector_type</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_selector_type</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;class_selector&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;class&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">selector</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                            <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">break</span>
            <span class="k">if</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;id_selector&quot;</span><span class="p">:</span>
                <span class="c1"># NOTE: testing has not uncovered this state</span>
                <span class="c1"># we&#39;re keeping it here just in case</span>
                <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">selector</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                            <span class="n">targets</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">break</span>
    <span class="k">return</span> <span class="n">targets</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="webcode_tk.cascade_tools.Element.get_contrast_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_contrast_data</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>get color contrast for the type specified</p>
<p>contrast data could be for one of three possibile types:
* default: this is when all elements get their default values,
* standard: this is for checking contrast between color and
background color,
* hover: for the hover pseudoselector - could be applied to any
element (not just hyperlinks)
* visited: for visited links</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>type</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the type of color contrast.</p>
              </div>
            </td>
            <td>
                  <code>&#39;default&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_contrast_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get color contrast for the type specified</span>

<span class="sd">    contrast data could be for one of three possibile types:</span>
<span class="sd">    * default: this is when all elements get their default values,</span>
<span class="sd">    * standard: this is for checking contrast between color and</span>
<span class="sd">    background color,</span>
<span class="sd">    * hover: for the hover pseudoselector - could be applied to any</span>
<span class="sd">    element (not just hyperlinks)</span>
<span class="sd">    * visited: for visited links</span>

<span class="sd">    Args:</span>
<span class="sd">        type: the type of color contrast.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">col</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">anc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">anc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">color_details</span> <span class="o">=</span> <span class="n">anc</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">color_details</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="s2">&quot;#&quot;</span> <span class="o">==</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s2">&quot;rgb&quot;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span> <span class="s2">&quot;hsl&quot;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">col</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>
                <span class="k">if</span> <span class="n">color</span><span class="o">.</span><span class="n">is_color_value</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
                    <span class="k">break</span>
    <span class="n">bg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">color</span><span class="o">.</span><span class="n">is_gradient</span><span class="p">(</span><span class="n">bg</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_color_contrast_with_gradients</span><span class="p">(</span>
            <span class="n">col</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestors</span>
        <span class="p">)</span>
        <span class="c1"># Set bg to composite color with lowest contrast ratio</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">has_alpha</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">has_alpha</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;has_alpha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;computed_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg</span>

    <span class="n">hexc</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_hex</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">hexbg</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_hex</span><span class="p">(</span><span class="n">bg</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__build_contrast_report</span><span class="p">(</span><span class="n">hexc</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span> <span class="ow">and</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;visited&quot;</span><span class="p">:</span>
        <span class="n">vcol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visited_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
        <span class="n">hexv</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_hex</span><span class="p">(</span><span class="n">vcol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__build_visited_contrast_report</span><span class="p">(</span><span class="n">hexv</span><span class="p">,</span> <span class="n">hexbg</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;hover&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hover_color</span><span class="p">[</span><span class="s2">&quot;applied_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;directly&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="webcode_tk.cascade_tools.__get_element_by_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__get_element_by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>returns element from id.</p>
<p>This is created to retrieve an element by its ID. The necessity
was born out of trying to ascertain whether a descendant selector
applies to an element while avoiding a recursive tree search through
the DOM.</p>
<p>Since a descendant selector could be using any type of selector
(example: <code>#main .nav ul a:hover {}</code>), then just knowing the name
is not enough.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>id</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the memory address of the element object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>element</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Element (webcode_tk.cascade_tools.Element)" href="#webcode_tk.cascade_tools.Element">Element</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the element object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__get_element_by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Element</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns element from id.</span>

<span class="sd">    This is created to retrieve an element by its ID. The necessity</span>
<span class="sd">    was born out of trying to ascertain whether a descendant selector</span>
<span class="sd">    applies to an element while avoiding a recursive tree search through</span>
<span class="sd">    the DOM.</span>

<span class="sd">    Since a descendant selector could be using any type of selector</span>
<span class="sd">    (example: `#main .nav ul a:hover {}`), then just knowing the name</span>
<span class="sd">    is not enough.</span>

<span class="sd">    Args:</span>
<span class="sd">        id: the memory address of the element object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        element: the element object.&quot;&quot;&quot;</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">py_object</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="k">return</span> <span class="n">element</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="webcode_tk.cascade_tools.attribute_selector_applies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attribute_selector_applies</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>determines if the attribute selector applies or not.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>element</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Element (webcode_tk.cascade_tools.Element)" href="#webcode_tk.cascade_tools.Element">Element</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the element in question.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>selector</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the attribute selector in question.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>applies</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a bool representing whether the attribute selector
applies or not.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">attribute_selector_applies</span><span class="p">(</span><span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;determines if the attribute selector applies or not.</span>

<span class="sd">    Args:</span>
<span class="sd">        element: the element in question.</span>
<span class="sd">        selector: the attribute selector in question.</span>

<span class="sd">    Returns:</span>
<span class="sd">        applies: a bool representing whether the attribute selector</span>
<span class="sd">            applies or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">applies</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="s2">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">start_pos</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">attr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;~&quot;</span><span class="p">):</span>
            <span class="n">attribute</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="n">start_pos</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="n">start_pos</span><span class="p">:]</span>
        <span class="k">if</span> <span class="s2">&quot;*=&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
            <span class="c1"># value need only be a partial match</span>
            <span class="n">attr</span><span class="p">,</span> <span class="n">partial</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;*=&quot;</span><span class="p">)</span>
            <span class="n">partial</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">partial</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;&quot;]&#39;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">partial</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                        <span class="n">applies</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">applies</span> <span class="o">=</span> <span class="n">partial</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="s2">&quot;$=&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
            <span class="c1"># looking for value ending in text</span>
            <span class="n">ending</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;$=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">ending</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">case_insenstive</span> <span class="o">=</span> <span class="s2">&quot;i]&quot;</span> <span class="ow">in</span> <span class="n">selector</span> <span class="ow">or</span> <span class="s2">&quot;i ]&quot;</span> <span class="ow">in</span> <span class="n">selector</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">end_pos</span> <span class="o">=</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="n">value_end</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">end_pos</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">case_insenstive</span><span class="p">:</span>
                    <span class="n">value_end</span> <span class="o">=</span> <span class="n">value_end</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="n">applies</span> <span class="o">=</span> <span class="n">text</span> <span class="o">==</span> <span class="n">value_end</span>
        <span class="k">elif</span> <span class="s2">&quot;~=&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
            <span class="c1"># looking for whole word in space-separated list</span>
            <span class="n">attr</span><span class="p">,</span> <span class="n">word</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;~=&quot;</span><span class="p">)</span>
            <span class="n">word</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">word</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;&quot;]&#39;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">word</span> <span class="o">==</span> <span class="n">v</span><span class="p">:</span>
                        <span class="n">applies</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">applies</span> <span class="o">=</span> <span class="n">word</span> <span class="o">==</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># we&#39;re just looking for an attribute match</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">selector</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="n">applies</span> <span class="o">=</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">applies</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="webcode_tk.cascade_tools.descendant_selector_applies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">descendant_selector_applies</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>checks all ancestors to see if the descendant selector applies.</p>
<p>First, we need to check the last component of the descendant selector
to see if it applies to the element in question. If so, continue. If
not, return with a False.</p>
<p>If the element has a match, then we need to check each tag leading up to
our element in question. According to the article by Pavel Panchekha,
"What is the Complexity of Selector Matching?" we should start at the
top of the DOM and work our way down.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">descendant_selector_applies</span><span class="p">(</span><span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">sel</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;checks all ancestors to see if the descendant selector applies.</span>

<span class="sd">    First, we need to check the last component of the descendant selector</span>
<span class="sd">    to see if it applies to the element in question. If so, continue. If</span>
<span class="sd">    not, return with a False.</span>

<span class="sd">    If the element has a match, then we need to check each tag leading up to</span>
<span class="sd">    our element in question. According to the article by Pavel Panchekha,</span>
<span class="sd">    &quot;What is the Complexity of Selector Matching?&quot; we should start at the</span>
<span class="sd">    top of the DOM and work our way down.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">applies</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">selector_list</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">ancestor_list</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">ancestors</span>
    <span class="n">possible_child_selector</span> <span class="o">=</span> <span class="n">selector_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">child_selector_applies</span> <span class="o">=</span> <span class="n">does_selector_apply</span><span class="p">(</span>
        <span class="n">element</span><span class="p">,</span> <span class="n">possible_child_selector</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">child_selector_applies</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">applies</span>

    <span class="c1"># loop through the ancestor list</span>
    <span class="n">current_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ancestor</span> <span class="ow">in</span> <span class="n">ancestor_list</span><span class="p">:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">ancestor</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ancestor_element</span> <span class="o">=</span> <span class="n">__get_element_by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selector_list</span><span class="p">:</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">selector_list</span><span class="p">[</span><span class="n">current_pos</span><span class="p">]</span>
            <span class="n">cur_selector_applies</span> <span class="o">=</span> <span class="n">does_selector_apply</span><span class="p">(</span>
                <span class="n">ancestor_element</span><span class="p">,</span> <span class="n">selector</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">cur_selector_applies</span><span class="p">:</span>
                <span class="n">selector_list</span> <span class="o">=</span> <span class="n">selector_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">applies</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">selector_list</span>
    <span class="k">return</span> <span class="n">applies</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="webcode_tk.cascade_tools.does_selector_apply" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">does_selector_apply</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>returns whether the selector applies to the element.</p>
<p>Since the selector could be a grouped selector, we might have to
loop through all selectors in the grouped selector. For that reason,
grouped selectors, will be converted to a list of selectors, and
non-grouped selectors will be placed in a list.</p>
<p>From there, we will loop through the list of selectors and check
for type, class, id, and any other selectors in our list of regex
expressions from the css library. With that information,
we can then check to see if it applies to the tag or not.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>element</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Element (webcode_tk.cascade_tools.Element)" href="#webcode_tk.cascade_tools.Element">Element</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the element we are checking.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>selector</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the selector in question.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>applies</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether the selector actually applies to the element.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">does_selector_apply</span><span class="p">(</span><span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns whether the selector applies to the element.</span>

<span class="sd">    Since the selector could be a grouped selector, we might have to</span>
<span class="sd">    loop through all selectors in the grouped selector. For that reason,</span>
<span class="sd">    grouped selectors, will be converted to a list of selectors, and</span>
<span class="sd">    non-grouped selectors will be placed in a list.</span>

<span class="sd">    From there, we will loop through the list of selectors and check</span>
<span class="sd">    for type, class, id, and any other selectors in our list of regex</span>
<span class="sd">    expressions from the css library. With that information,</span>
<span class="sd">    we can then check to see if it applies to the tag or not.</span>

<span class="sd">    Args:</span>
<span class="sd">        element: the element we are checking.</span>
<span class="sd">        selector: the selector in question.</span>

<span class="sd">    Returns:</span>
<span class="sd">        applies: whether the selector actually applies to the element.&quot;&quot;&quot;</span>
    <span class="n">applies</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">regex_patterns</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">regex_patterns</span>
    <span class="n">element_name</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span>

    <span class="c1"># make a list of all selectors (in case of grouped selector)</span>
    <span class="n">selectors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">is_grouped</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
        <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex_patterns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;grouped_selector&quot;</span><span class="p">),</span> <span class="n">selector</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">is_grouped</span><span class="p">:</span>
        <span class="n">selectors</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">selectors</span><span class="p">:</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">is_link_selector</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex_patterns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;advanced_link_selector&quot;</span><span class="p">),</span> <span class="n">sel</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">selector</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span>
        <span class="p">)</span>
        <span class="n">is_type_selector</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex_patterns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;single_type_selector&quot;</span><span class="p">),</span> <span class="n">sel</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">is_id_selector</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex_patterns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id_selector&quot;</span><span class="p">),</span> <span class="n">sel</span><span class="p">))</span>
        <span class="n">is_class_selector</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex_patterns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;class_selector&quot;</span><span class="p">),</span> <span class="n">sel</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">is_class_selector</span> <span class="o">=</span> <span class="n">is_class_selector</span> <span class="ow">or</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">sel</span>
        <span class="n">is_psuedo_class_selector</span> <span class="o">=</span> <span class="n">is_selector_pseudoclass</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
        <span class="n">is_attribute_selector</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex_patterns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;single_attribute_selector&quot;</span><span class="p">),</span> <span class="n">sel</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">is_descendant_selector</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">regex_patterns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;descendant_selector&quot;</span><span class="p">),</span> <span class="n">sel</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">is_at_rule</span> <span class="o">=</span> <span class="s2">&quot;@&quot;</span> <span class="ow">in</span> <span class="n">sel</span>

        <span class="c1"># If the tag is an anchor, but the selector is not - doesn&#39;t apply</span>
        <span class="c1"># link color can only be changed by a link selector</span>
        <span class="k">if</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
            <span class="c1"># NOTE: turns out a descendant selector targetting an anchor won&#39;t</span>
            <span class="c1"># show as a link_selector</span>
            <span class="k">if</span> <span class="n">is_descendant_selector</span><span class="p">:</span>
                <span class="n">selector_list</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                <span class="c1"># Check the descendant to see if it is a link</span>
                <span class="n">last_item</span> <span class="o">=</span> <span class="n">selector_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;a&quot;</span> <span class="o">!=</span> <span class="n">last_item</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">break</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">is_link_selector</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">is_type_selector</span><span class="p">:</span>
            <span class="n">applies</span> <span class="o">=</span> <span class="n">element_name</span> <span class="o">==</span> <span class="n">sel</span>
            <span class="k">if</span> <span class="n">applies</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">elif</span> <span class="n">is_id_selector</span><span class="p">:</span>
            <span class="c1"># get ID attribute (if there is one)</span>
            <span class="n">possible_el</span><span class="p">,</span> <span class="n">id_attr</span> <span class="o">=</span> <span class="n">selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span> <span class="n">abc</span><span class="o">.</span><span class="n">ItemsView</span><span class="p">):</span>
                    <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">id</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span>
                            <span class="n">element_id</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">element_id</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">possible_el</span><span class="p">:</span>
                    <span class="n">applies</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">possible_el</span> <span class="o">==</span> <span class="n">element_name</span> <span class="ow">and</span> <span class="n">id_attr</span> <span class="o">==</span> <span class="n">element_id</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">applies</span> <span class="o">=</span> <span class="n">id_attr</span> <span class="o">==</span> <span class="n">element_id</span>
                <span class="k">if</span> <span class="n">applies</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">elif</span> <span class="n">is_class_selector</span><span class="p">:</span>
            <span class="c1"># get all class attributes</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span>
            <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;class&quot;</span><span class="p">:</span>
                        <span class="n">possible_selectors</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">class_values</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">class_values</span><span class="p">:</span>
                            <span class="n">possible_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">val</span><span class="p">)</span>
                            <span class="n">possible_selectors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">val</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">selector</span> <span class="ow">in</span> <span class="n">possible_selectors</span><span class="p">:</span>
                            <span class="n">applies</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">is_link_selector</span><span class="p">:</span>
            <span class="c1"># If the selector is a link selector, but the element is not</span>
            <span class="c1"># NOTE: if this doesn&#39;t solve it, we should double check the</span>
            <span class="c1"># parent to see if it was a link (might already be taken care of)</span>
            <span class="k">if</span> <span class="n">element_name</span> <span class="o">==</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span>
                <span class="c1"># first check for attributes</span>
                <span class="k">if</span> <span class="n">is_attribute_selector</span><span class="p">:</span>
                    <span class="c1"># check to see if there is both an attribute and value</span>
                    <span class="n">applies</span> <span class="o">=</span> <span class="n">attribute_selector_applies</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">applies</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">is_psuedo_class_selector</span><span class="p">:</span>
            <span class="c1"># check for element before psuedoclass</span>
            <span class="n">pre_pseudo</span> <span class="o">=</span> <span class="n">sel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">applies</span> <span class="o">=</span> <span class="n">pre_pseudo</span> <span class="o">==</span> <span class="n">element_name</span>
            <span class="k">if</span> <span class="n">applies</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">elif</span> <span class="n">is_attribute_selector</span><span class="p">:</span>
            <span class="n">applies</span> <span class="o">=</span> <span class="n">attribute_selector_applies</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_descendant_selector</span><span class="p">:</span>
            <span class="n">applies</span> <span class="o">=</span> <span class="n">descendant_selector_applies</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">sel</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">applies</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">elif</span> <span class="n">is_at_rule</span><span class="p">:</span>
            <span class="c1"># We should return false as it is an @rule and shouldn&#39;t</span>
            <span class="c1"># apply</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Selector not recognized: Got </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">applies</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="webcode_tk.cascade_tools.get_color_contrast_details" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_color_contrast_details</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">rating</span><span class="o">=</span><span class="s1">&#39;AAA&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>returns a list of all failures or a pass based on rating</p>
<p>We'll create a recursive inner nested function to traverse the DOM. We
will target all elements, and then report on number of errors triggered
by each selector to help avoid overwhelming the user with too many
errors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tree</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="CSSAppliedTree (webcode_tk.cascade_tools.CSSAppliedTree)" href="#webcode_tk.cascade_tools.CSSAppliedTree">CSSAppliedTree</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the cascade tree for a single file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rating</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the rating of contrast we check for (AAA or AA). The default
is AAA.</p>
              </div>
            </td>
            <td>
                  <code>&#39;AAA&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    results</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_color_contrast_details</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">CSSAppliedTree</span><span class="p">,</span> <span class="n">rating</span><span class="o">=</span><span class="s2">&quot;AAA&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns a list of all failures or a pass based on rating</span>

<span class="sd">    We&#39;ll create a recursive inner nested function to traverse the DOM. We</span>
<span class="sd">    will target all elements, and then report on number of errors triggered</span>
<span class="sd">    by each selector to help avoid overwhelming the user with too many</span>
<span class="sd">    errors.</span>

<span class="sd">    Args:</span>
<span class="sd">        tree: the cascade tree for a single file.</span>
<span class="sd">        rating: the rating of contrast we check for (AAA or AA). The default</span>
<span class="sd">            is AAA.</span>
<span class="sd">    Returns:</span>
<span class="sd">        results</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">filename</span>
    <span class="c1"># Loop recursively through the tree</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">children</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_element</span><span class="p">(</span>
        <span class="n">el</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">rating</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parent_sel</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="n">children</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">children</span>

        <span class="n">is_gradient</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;is_gradient&quot;</span><span class="p">)</span>

        <span class="c1"># if the gradient was not directly applied, we won&#39;t get is_gradient</span>
        <span class="c1"># since it might be applied contextually, we should double check</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_gradient</span><span class="p">:</span>
            <span class="n">bg_value</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
            <span class="n">is_gradient</span> <span class="o">=</span> <span class="s2">&quot;gradient&quot;</span> <span class="ow">in</span> <span class="n">bg_value</span>

            <span class="c1"># we should recalculate contrast if it didn&#39;t register</span>
            <span class="k">if</span> <span class="n">is_gradient</span><span class="p">:</span>
                <span class="n">fg_color</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="n">bg_color</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                <span class="n">contrast_details</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_color_contrast_with_gradients</span><span class="p">(</span>
                    <span class="n">fg_color</span><span class="p">,</span> <span class="n">bg_color</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">ancestors</span>
                <span class="p">)</span>
                <span class="n">worst_case</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;has_alpha&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;computed_value&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;contrast_ratio&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                    <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">contrast</span><span class="p">,</span> <span class="n">fg_color</span> <span class="o">=</span> <span class="n">contrast_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">composite_bg</span><span class="p">,</span> <span class="n">bg_has_alpha</span> <span class="o">=</span> <span class="n">contrast_details</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">:]</span>
                <span class="n">worst_case</span><span class="p">[</span><span class="s2">&quot;has_alpha&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bg_has_alpha</span>
                <span class="n">worst_case</span><span class="p">[</span><span class="s2">&quot;computed_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">composite_bg</span>
                <span class="n">worst_case</span><span class="p">[</span><span class="s2">&quot;contrast_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">contrast</span>
                <span class="n">hex1</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_hex</span><span class="p">(</span><span class="n">fg_color</span><span class="p">)</span>
                <span class="n">hex2</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_hex</span><span class="p">(</span><span class="n">composite_bg</span><span class="p">)</span>
                <span class="n">passes_contrast</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_contrast_results_from_ratio</span><span class="p">(</span>
                    <span class="n">contrast</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">is_bold</span>
                <span class="p">)</span>
                <span class="n">worst_case</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">passes_contrast</span>
                <span class="n">el</span><span class="o">.</span><span class="n">background_color</span><span class="p">[</span><span class="s2">&quot;worst_contrast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">worst_case</span>
        <span class="k">if</span> <span class="n">is_gradient</span><span class="p">:</span>
            <span class="c1"># get worst case</span>
            <span class="n">worst_case</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;worst_contrast&quot;</span><span class="p">)</span>
            <span class="n">worst_results</span> <span class="o">=</span> <span class="n">worst_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;results&quot;</span><span class="p">)</span>
            <span class="n">fails</span> <span class="o">=</span> <span class="s2">&quot;fail&quot;</span> <span class="ow">in</span> <span class="n">worst_results</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;conditional pass&quot;</span> <span class="ow">in</span> <span class="n">worst_results</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rating</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">worst_results</span><span class="p">:</span>
                    <span class="n">fails</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">fails</span><span class="p">:</span>
                <span class="n">selector</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">is_large</span><span class="p">:</span>
                    <span class="n">size</span> <span class="o">=</span> <span class="s2">&quot;Large&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">size</span> <span class="o">=</span> <span class="s2">&quot;Normal&quot;</span>
                <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">has_direct_text</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">selector</span> <span class="ow">and</span> <span class="n">parent_sel</span><span class="p">:</span>
                        <span class="n">selector</span> <span class="o">=</span> <span class="n">parent_sel</span>
                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">rating</span><span class="p">)</span>
                        <span class="p">)</span>

                    <span class="c1"># NOTE: it&#39;s possible we won&#39;t be able to get a selector</span>
                    <span class="c1"># in the future. If so, add an else block and deal with it</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># We have a failure, but without direct text</span>
                    <span class="c1"># We need to verify whether the failure is passed</span>
                    <span class="c1"># on to the children or not</span>
                    <span class="n">parent_bg</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">background_color</span>
                    <span class="n">parent_bg_selector</span> <span class="o">=</span> <span class="n">parent_bg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
                    <span class="n">parent_col</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">color</span>
                    <span class="n">parent_col_selector</span> <span class="o">=</span> <span class="n">parent_col</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                        <span class="n">child_bg_val</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                        <span class="n">child_col_val</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>

                        <span class="c1"># Check to see if the values in the child are the</span>
                        <span class="c1"># same as with the parent, in which case, if parent</span>
                        <span class="c1"># fails, then child should too</span>
                        <span class="k">if</span> <span class="n">child_bg_val</span> <span class="o">==</span> <span class="n">parent_bg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                            <span class="s2">&quot;value&quot;</span>
                        <span class="p">)</span> <span class="ow">and</span> <span class="n">child_col_val</span> <span class="o">==</span> <span class="n">parent_col</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">):</span>
                            <span class="n">selector</span> <span class="o">=</span> <span class="n">parent_bg_selector</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">selector</span><span class="p">:</span>
                                <span class="n">selector</span> <span class="o">=</span> <span class="n">parent_col_selector</span>

                            <span class="c1"># double check to make sure child is same size or</span>
                            <span class="c1"># smaller than parent (size is parent&#39;s size)</span>
                            <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="s2">&quot;Normal&quot;</span> <span class="ow">and</span> <span class="n">child</span><span class="o">.</span><span class="n">is_large</span><span class="p">:</span>
                                <span class="n">hex1</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_hex</span><span class="p">(</span><span class="n">child_bg_val</span><span class="p">)</span>

                                <span class="c1"># In case the bg color is a gradient, we</span>
                                <span class="c1"># need to pull from parent&#39;s bg_data</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">hex1</span><span class="p">:</span>
                                    <span class="n">css_color</span> <span class="o">=</span> <span class="n">parent_bg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;computed_value&quot;</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">css_color</span><span class="p">:</span>
                                        <span class="n">hex1</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_hex</span><span class="p">(</span><span class="n">css_color</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">parent_bg_val</span> <span class="o">=</span> <span class="n">worst_case</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span>
                                        <span class="n">hex1</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_hex</span><span class="p">(</span><span class="n">parent_bg_val</span><span class="p">)</span>
                                <span class="n">hex2</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">get_hex</span><span class="p">(</span><span class="n">child_col_val</span><span class="p">)</span>
                                <span class="n">child_contrast</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">color</span><span class="o">.</span><span class="n">get_color_contrast_report</span><span class="p">(</span><span class="n">hex1</span><span class="p">,</span> <span class="n">hex2</span><span class="p">)</span>
                                <span class="p">)</span>
                                <span class="n">child_sizing</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Large </span><span class="si">{</span><span class="n">rating</span><span class="si">}</span><span class="s2">&quot;</span>
                                <span class="n">passes</span> <span class="o">=</span> <span class="s2">&quot;Fail&quot;</span> <span class="o">!=</span> <span class="n">child_contrast</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                    <span class="n">child_sizing</span>
                                <span class="p">)</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">passes</span><span class="p">:</span>
                                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                        <span class="p">(</span>
                                            <span class="n">filename</span><span class="p">,</span>
                                            <span class="n">selector</span><span class="p">,</span>
                                            <span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                            <span class="n">size</span><span class="p">,</span>
                                            <span class="n">rating</span><span class="p">,</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">rating</span><span class="p">)</span>
                                <span class="p">)</span>

                        <span class="c1"># TODO: add tests to look for a parent with normal</span>
                        <span class="c1"># size and a child that&#39;s large - make an else block</span>
                <span class="k">return</span>
        <span class="n">contrast_data</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">contrast_data</span>
        <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">is_large</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rating</span> <span class="o">==</span> <span class="s2">&quot;AAA&quot;</span><span class="p">:</span>
                <span class="n">passes</span> <span class="o">=</span> <span class="n">contrast_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;large_aaa&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">passes</span> <span class="o">=</span> <span class="n">contrast_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;large_aa&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rating</span> <span class="o">==</span> <span class="s2">&quot;AAA&quot;</span><span class="p">:</span>
                <span class="n">passes</span> <span class="o">=</span> <span class="n">contrast_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normal_aaa&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">passes</span> <span class="o">=</span> <span class="n">contrast_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normal_aa&quot;</span><span class="p">)</span>

        <span class="c1"># only add results if failure</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">passes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">is_large</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="s2">&quot;Large&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="s2">&quot;Normal&quot;</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">selector</span><span class="p">:</span>
                <span class="n">selector</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>

            <span class="c1"># if there still isn&#39;t a selector, get the parent selector</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">selector</span><span class="p">:</span>
                <span class="n">selector</span> <span class="o">=</span> <span class="n">parent_sel</span>

            <span class="c1"># and only if the element has direct text (experimental)</span>
            <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">has_direct_text</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">filename</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">rating</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">children</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">):</span>
                    <span class="n">parent_selector</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">background_color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parent_selector</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;selector&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">parent_selector</span><span class="p">:</span>
                    <span class="n">parent_selector</span> <span class="o">=</span> <span class="n">kid</span><span class="o">.</span><span class="n">ancestors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">parent_selector</span><span class="p">:</span>
                        <span class="n">parent_selector</span> <span class="o">=</span> <span class="n">kid</span><span class="o">.</span><span class="n">ancestors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">parent_selector</span><span class="p">:</span>
                        <span class="n">parent_selector</span> <span class="o">=</span> <span class="n">parent_selector</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;selector:&quot;</span><span class="p">)[</span>
                            <span class="o">-</span><span class="mi">1</span>
                        <span class="p">]</span>
                <span class="n">check_element</span><span class="p">(</span><span class="n">kid</span><span class="p">,</span> <span class="n">rating</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">parent_selector</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
        <span class="n">check_element</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">rating</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">adjusted</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">file</span><span class="p">,</span> <span class="n">selector</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">rating</span> <span class="o">=</span> <span class="n">result</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;fail: in </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">, element: &lt;</span><span class="si">{</span><span class="n">element</span><span class="si">}</span><span class="s2">&gt; had </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;contrast errors for </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rating</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;contrast error for </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">rating</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;triggered by selector </span><span class="si">{</span><span class="n">selector</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">if</span> <span class="n">msg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">adjusted</span><span class="p">:</span>
                <span class="n">adjusted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">adjusted</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># It&#39;s a success! Let&#39;s let them know</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;pass: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> passes color contrast for </span><span class="si">{</span><span class="n">rating</span><span class="si">}</span><span class="s2"> Normal&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; and Large.&quot;</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="webcode_tk.cascade_tools.get_color_contrast_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_color_contrast_report</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="n">rating</span><span class="o">=</span><span class="s1">&#39;AAA&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>returns a list of all failures or a pass based on rating</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dir_path</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the path to the directory in question</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rating</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the rating of contrast we check for (AAA or AA). The default
is AAA.</p>
              </div>
            </td>
            <td>
                  <code>&#39;AAA&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    results: a list of pass or fail messages.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_color_contrast_report</span><span class="p">(</span><span class="n">dir_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rating</span><span class="o">=</span><span class="s2">&quot;AAA&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns a list of all failures or a pass based on rating</span>

<span class="sd">    Args:</span>
<span class="sd">        dir_path: the path to the directory in question</span>
<span class="sd">        rating: the rating of contrast we check for (AAA or AA). The default</span>
<span class="sd">            is AAA.</span>
<span class="sd">    Returns:</span>
<span class="sd">        results: a list of pass or fail messages.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_styles_by_html_files</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">)</span>
        <span class="n">stylesheets</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stylesheets&quot;</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">CSSAppliedTree</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">stylesheets</span><span class="p">)</span>

        <span class="n">report</span> <span class="o">=</span> <span class="n">get_color_contrast_details</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">rating</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">report</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="webcode_tk.cascade_tools.get_color_contrast_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_color_contrast_results</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">min_regular</span><span class="o">=</span><span class="s1">&#39;AAA&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>returns a list of color contrast results for all elements in a file.</p>
<p>Recursively searches through the css_tree of HTML elements looking to
determine whether the element is normal or large in size, and whether it
passes the AIM color contrast goals.</p>
<p>The minimum passing level could be either at an AAA or AA level (according
to the WebAIM Color Contrast Checker). Be default we'll look for AAA
sizes to see if they pass.
<a href="https://webaim.org/resources/contrastchecker/">WebAim Contrast Checker</a></p>
<p>Calculating whether an element qualifies as large depends on the styles
applied. The CSSAppliedTree and Element objects now support computed font
size as well as whether each Element object is large or not based on the
description in the WebAim Contrast Checker.</p>
<p>It states, "Large text is defined as 14 point (typically 18.66px) and bold
or larger, or 18 point (typically 24px) or larger."</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>css_tree</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the css tree of color styles for a particular file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_regular</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the minimum passing size ('AAA' or 'AA') for color
contrast for normal sized elements (anything except h1-h4).</p>
              </div>
            </td>
            <td>
                  <code>&#39;AAA&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>results</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a dictionary of color contrast results for each element in
the file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_color_contrast_results</span><span class="p">(</span>
    <span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">min_regular</span><span class="o">=</span><span class="s2">&quot;AAA&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns a list of color contrast results for all elements in a file.</span>

<span class="sd">    Recursively searches through the css_tree of HTML elements looking to</span>
<span class="sd">    determine whether the element is normal or large in size, and whether it</span>
<span class="sd">    passes the AIM color contrast goals.</span>

<span class="sd">    The minimum passing level could be either at an AAA or AA level (according</span>
<span class="sd">    to the WebAIM Color Contrast Checker). Be default we&#39;ll look for AAA</span>
<span class="sd">    sizes to see if they pass.</span>
<span class="sd">    [WebAim Contrast Checker](https://webaim.org/resources/contrastchecker/)</span>

<span class="sd">    Calculating whether an element qualifies as large depends on the styles</span>
<span class="sd">    applied. The CSSAppliedTree and Element objects now support computed font</span>
<span class="sd">    size as well as whether each Element object is large or not based on the</span>
<span class="sd">    description in the WebAim Contrast Checker.</span>

<span class="sd">    It states, &quot;Large text is defined as 14 point (typically 18.66px) and bold</span>
<span class="sd">    or larger, or 18 point (typically 24px) or larger.&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        css_tree: the css tree of color styles for a particular file.</span>
<span class="sd">        min_regular: the minimum passing size (&#39;AAA&#39; or &#39;AA&#39;) for color</span>
<span class="sd">            contrast for normal sized elements (anything except h1-h4).</span>

<span class="sd">    Returns:</span>
<span class="sd">        results: a dictionary of color contrast results for each element in</span>
<span class="sd">            the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span>
    <span class="n">is_large</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">is_large</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;num_elements&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;num_passed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;num_failed&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;all_pass&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">update_contrast_results</span><span class="p">(</span>
        <span class="n">results</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">is_large</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">contrast_data</span><span class="p">,</span> <span class="n">min_regular</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">get_color_contrast_results</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">min_regular</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="webcode_tk.cascade_tools.is_selector_pseudoclass" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_selector_pseudoclass</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>returns whether selector is a pseudoclass selector.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>selector</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the selector in question.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>is_pseudo_class_selector</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether the selector is a psuedoclass
or not.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_selector_pseudoclass</span><span class="p">(</span><span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns whether selector is a pseudoclass selector.</span>

<span class="sd">    Args:</span>
<span class="sd">        selector: the selector in question.</span>

<span class="sd">    Returns:</span>
<span class="sd">        is_pseudo_class_selector: whether the selector is a psuedoclass</span>
<span class="sd">            or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pc_regex</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">regex_patterns</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pseudoclass_selector&quot;</span><span class="p">)</span>
    <span class="n">is_pseudo_class_selector</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pc_regex</span><span class="p">,</span> <span class="n">selector</span><span class="p">))</span>
    <span class="n">is_pseudo_class_selector</span> <span class="o">=</span> <span class="n">is_pseudo_class_selector</span> <span class="ow">or</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">selector</span>

    <span class="c1"># pseudo-elements do NOT count - they are scored like a type selector</span>
    <span class="k">if</span> <span class="s2">&quot;::&quot;</span> <span class="ow">in</span> <span class="n">selector</span><span class="p">:</span>
        <span class="n">is_pseudo_class_selector</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">is_pseudo_class_selector</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="webcode_tk.cascade_tools.targets_element_directly" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">targets_element_directly</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">selector</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>returns whether selector targets element directly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>element</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Element (webcode_tk.cascade_tools.Element)" href="#webcode_tk.cascade_tools.Element">Element</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the element we are checking.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>selector</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the selector in question.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    targets: whether the selector targets the element directly.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">targets_element_directly</span><span class="p">(</span><span class="n">element</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span> <span class="n">selector</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns whether selector targets element directly.</span>

<span class="sd">    Args:</span>
<span class="sd">        element: the element we are checking.</span>
<span class="sd">        selector: the selector in question.</span>
<span class="sd">    Returns:</span>
<span class="sd">        targets: whether the selector targets the element directly.&quot;&quot;&quot;</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">selector_type</span> <span class="o">=</span> <span class="n">css</span><span class="o">.</span><span class="n">get_selector_type</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;type_selector&quot;</span><span class="p">:</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">selector</span>
    <span class="k">elif</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;id_selector&quot;</span><span class="p">:</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span>
        <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">attributes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;This is not a dictionary and cannot be converted&quot;</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; into one!&quot;</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_type</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">attributes</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
            <span class="n">id_attribute</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">id_attribute</span><span class="p">:</span>
                <span class="n">targets</span> <span class="o">=</span> <span class="n">selector</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">selector_type</span> <span class="o">==</span> <span class="s2">&quot;class_selector&quot;</span><span class="p">:</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attributes</span>
        <span class="k">if</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">classes</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">classes</span><span class="p">:</span>
                <span class="n">selector_value</span> <span class="o">=</span> <span class="n">selector</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">targets</span> <span class="o">=</span> <span class="n">selector_value</span> <span class="ow">in</span> <span class="n">classes</span>
    <span class="k">return</span> <span class="n">targets</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="webcode_tk.cascade_tools.update_contrast_results" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_contrast_results</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">is_large</span><span class="p">,</span> <span class="n">contrast_data</span><span class="p">,</span> <span class="n">min_regular</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>updates the results of color contrast for the tag.</p>
<p>we've updated this to match whether the element computes as large or not
based on the WebAIM Color Contrast page which states, 'Large text is
defined as 14 point (typically 18.66px) and bold or larger, or 18 point
(typically 24px) or larger.'</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>results</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the overall results we want to adjust.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tag</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the element we want to adjust.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_large</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether the element is considered large.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>contrast_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the contrast results for the tag.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_regular</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the minimum level required for standard text passing.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>results</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>adjusted results after processing contrast data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>webcode_tk/cascade_tools.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_contrast_results</span><span class="p">(</span>
    <span class="n">results</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">is_large</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">contrast_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">min_regular</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;updates the results of color contrast for the tag.</span>

<span class="sd">    we&#39;ve updated this to match whether the element computes as large or not</span>
<span class="sd">    based on the WebAIM Color Contrast page which states, &#39;Large text is</span>
<span class="sd">    defined as 14 point (typically 18.66px) and bold or larger, or 18 point</span>
<span class="sd">    (typically 24px) or larger.&#39;</span>

<span class="sd">    Args:</span>
<span class="sd">        results: the overall results we want to adjust.</span>
<span class="sd">        tag: the element we want to adjust.</span>
<span class="sd">        is_large: whether the element is considered large.</span>
<span class="sd">        contrast_data: the contrast results for the tag.</span>
<span class="sd">        min_regular: the minimum level required for standard text passing.</span>

<span class="sd">    Returns:</span>
<span class="sd">        results: adjusted results after processing contrast data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">passes</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;num_elements&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">is_large</span><span class="p">:</span>
        <span class="n">passes</span> <span class="o">=</span> <span class="n">contrast_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;large_aaa&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">min_regular</span> <span class="o">==</span> <span class="s2">&quot;AAA&quot;</span><span class="p">:</span>
            <span class="n">passes</span> <span class="o">=</span> <span class="n">contrast_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normal_aaa&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">passes</span> <span class="o">=</span> <span class="n">contrast_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normal_aa&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">passes</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;num_passed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;num_failed&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;all_pass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;num_failed&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>